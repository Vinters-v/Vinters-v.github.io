

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/blog_img/avatar_my.jpg">
  <link rel="icon" href="/img/blog_img/avatar_my.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Vinters-v">
  <meta name="keywords" content="">
  
    <meta name="description" content="UVM基础知识笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="UVM基础知识笔记">
<meta property="og:url" content="http://vinters-v.github.io/2025/03/22/%E6%95%B0%E5%AD%97IC%E2%80%94%E2%80%94UVM/index.html">
<meta property="og:site_name" content="Vinters-v">
<meta property="og:description" content="UVM基础知识笔记">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://vinters-v.github.io/img/article_img/IC/IC.jpg">
<meta property="article:published_time" content="2025-03-22T02:55:18.824Z">
<meta property="article:modified_time" content="2025-06-12T06:48:26.522Z">
<meta property="article:author" content="Vinters-v">
<meta property="article:tag" content="UVM">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://vinters-v.github.io/img/article_img/IC/IC.jpg">
  
  
  
  <title>UVM基础知识笔记 - Vinters-v</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"vinters-v.github.io","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"left","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/blog_img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Vinters-v</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/blog_img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="UVM基础知识笔记"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-03-22 10:55" pubdate>
          2025年3月22日 上午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          44k 字
        
      </span>
    

    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="padding-left: 2rem; margin-right: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">UVM基础知识笔记</h1>
            
            
              <div class="markdown-body">
                
                <p>UVM基础知识笔记</p>
<span id="more"></span>

<h1 id="UVM"><a href="#UVM" class="headerlink" title="UVM"></a>UVM</h1><h2 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h2><p><strong>parent 的作用</strong></p>
<p>(1) 构建 UVM 组件树（Hierarchy）<br>        UVM 环境是一个 树形结构，根节点是 uvm_top（全局顶级节点），所有组件（如 driver、monitor、agent）必须有一个父节点。</p>
<p>​		parent 参数指定当前组件的父组件，确保它被正确挂载到 UVM 树中。</p>
<p>(2) 支持 get_parent() 和路径访问<br>        通过 parent，可以使用 get_parent() 向上遍历组件树。</p>
<p>​		调试时，get_full_name() 会生成完整路径（如 top.env.agent.driver）。</p>
<p>(3) 自动化的 Phase 执行<br>        UVM 的 Phase 机制（如 build_phase、connect_phase）依赖父子关系决定执行顺序。</p>
<p>​		父组件的 build_phase 先于子组件执行。</p>
<p>​		子组件的 connect_phase 在父组件的 connect_phase 之前执行。</p>
<p>(4) 配置机制（Config DB）<br>        父组件可以通过 uvm_config_db 向子组件传递配置参数。</p>
<p>​		子组件通过 parent 继承或覆盖配置。</p>
<p> <strong>示例代码分析</strong></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">class</span> my_driver <span class="hljs-keyword">extends</span> uvm_driver;<br>    <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name = <span class="hljs-string">&quot;my_driver&quot;</span>, uvm_component parent);<br>        <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);  <span class="hljs-comment">// 必须传递 parent</span><br>    <span class="hljs-keyword">endfunction</span><br><span class="hljs-keyword">endclass</span><br></code></pre></td></tr></table></figure>

<ul>
<li>**<code>super.new(name, parent)</code>**：调用父类（<code>uvm_driver</code>）的构造函数，将当前组件注册到 UVM 树中。</li>
<li>**如果不传递 <code>parent</code>**：<ul>
<li>组件无法挂载到 UVM 树中，导致 Phase 无法执行。</li>
<li>无法通过 <code>get_parent()</code> 或 <code>get_full_name()</code> 调试。</li>
<li>配置数据库（Config DB）可能失效。</li>
</ul>
</li>
</ul>
<hr>
<p> <strong>3. 特殊情况处理</strong></p>
<p> <strong>(1) 顶级组件（如 <code>uvm_test</code>）的 <code>parent</code></strong></p>
<p>顶级组件（如 <code>uvm_test</code>）的 <code>parent</code> 是 <code>null</code>，因为它本身就是根节点：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">class</span> my_test <span class="hljs-keyword">extends</span> uvm_test;<br>    <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name = <span class="hljs-string">&quot;my_test&quot;</span>, uvm_component parent = <span class="hljs-literal">null</span>);<br>        <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);  <span class="hljs-comment">// parent 为 null</span><br>    <span class="hljs-keyword">endfunction</span><br><span class="hljs-keyword">endclass</span><br></code></pre></td></tr></table></figure>

<p> <strong>(2) 动态创建组件</strong></p>
<p>如果通过 <code>create_component</code> 动态创建组件，UVM 会自动传递 <code>parent</code>：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs verilog">my_driver drv;<br>drv = my_driver::type_id::create(<span class="hljs-string">&quot;drv&quot;</span>, <span class="hljs-keyword">this</span>);  <span class="hljs-comment">// &quot;this&quot; 是父组件</span><br></code></pre></td></tr></table></figure>



<p><strong>uvm_config_db</strong></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs verilog">uvm_config_db<span class="hljs-variable">#(svk_axi_sys_env_cfg)::set(this, &quot;axi_sys_env&quot;, &quot;cfg&quot;, axi_sys_env_cfg)</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li><p><strong><code>uvm_config_db#(svk_axi_sys_env_cfg)</code></strong><br>指定配置数据库中存储的数据类型为 <code>svk_axi_sys_env_cfg</code>（一个自定义的配置类）。</p>
</li>
<li><p><strong><code>::set()</code></strong><br>静态方法，用于将配置对象存入数据库。</p>
</li>
<li><p>参数说明：</p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>this</code></td>
<td align="left">调用者的上下文（通常是当前组件，用于确定路径）。</td>
</tr>
<tr>
<td align="left"><code>&quot;axi_sys_env&quot;</code></td>
<td align="left">目标组件的路径（相对或绝对路径）。</td>
</tr>
<tr>
<td align="left"><code>&quot;cfg&quot;</code></td>
<td align="left">配置对象的键名（Key），用于后续查找。</td>
</tr>
<tr>
<td align="left"><code>axi_sys_env_cfg</code></td>
<td align="left">要存储的实际配置对象（类型为 <code>svk_axi_sys_env_cfg</code>）。</td>
</tr>
</tbody></table>
</li>
</ul>
<p>这行代码的目的是：<br>将一个名为 <code>axi_sys_env_cfg</code> 的配置对象（类型为 <code>svk_axi_sys_env_cfg</code>）存入 UVM 配置数据库，并关联到路径 <code>axi_sys_env</code> 的组件，键名为 <code>&quot;cfg&quot;</code></p>
<p>之后，目标组件（如 <code>axi_sys_env</code>）可以通过 <code>uvm_config_db::get()</code> 获取该配置对象。</p>
<p><code>this</code></p>
<ul>
<li>表示当前组件的上下文（通常是 <code>uvm_component</code> 的 <code>this</code>）。</li>
<li>用于生成目标的 绝对路径（如 <code>uvm_test_top.env.axi_sys_env</code>）。</li>
</ul>
<p><code>&quot;axi_sys_env&quot;</code></p>
<ul>
<li>目标组件的 路径名，可以是：<ul>
<li>相对路径（如 <code>&quot;axi_sys_env&quot;</code>）：相对于 <code>this</code> 的路径。</li>
<li>绝对路径（如 <code>&quot;uvm_test_top.env.axi_sys_env&quot;</code>）：从根节点开始。</li>
</ul>
</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs verilog">axi_sys_env = svk_axi_sys_env::type_id::create(<span class="hljs-string">&quot;axi_sys_env&quot;</span>, <span class="hljs-keyword">this</span>);<br></code></pre></td></tr></table></figure>

<p><code>svk_axi_sys_env</code><br>这是一个自定义的 UVM 组件类（通常继承自 <code>uvm_env</code> 或 <code>uvm_component</code>），用于构建 AXI 系统级验证环境。<br><code>::type_id::create()</code><br><code>type_id</code> 是 UVM 工厂（Factory）为每个注册的类自动生成的代理类。<br><code>create()</code> 是 UVM 工厂的动态实例化方法，替代直接调用 <code>new()</code>，支持后续的 对象覆盖（Override）机制。</p>
<h2 id="driver"><a href="#driver" class="headerlink" title="driver"></a>driver</h2><p><strong>my_dtiver.sv</strong></p>
<p>function与task的区别</p>
<p>function通常用于计算并返回一个值，而task更像是执行一系列操作，可能包含时间控制语句。</p>
<p>function不能包含延迟、事件或阻塞语句，因为它们需要立即返回值。而task可以包含这些时间控制的语句，比如#延迟，@事件，或者wait语句。</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> MY_DRIVER__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> MY_DRIVER__SV</span><br><span class="hljs-keyword">class</span> my_driver <span class="hljs-keyword">extends</span> uvm_driver;<br>    <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name = <span class="hljs-string">&quot;my_driver&quot;</span>, uvm_component parent = <span class="hljs-literal">null</span>);<br>        <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);  <span class="hljs-comment">//构造函数</span><br>    <span class="hljs-keyword">endfunction</span><br>    <span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">task</span> main_phase(uvm_phase phase); <span class="hljs-comment">//允许在类的外部进行定义</span><br><span class="hljs-keyword">endclass</span><br><br><span class="hljs-keyword">task</span> my_driver::main_phase(uvm_phase phase);<br>    top_tb<span class="hljs-variable">.rxd</span> &lt;= <span class="hljs-number">8&#x27;b0</span>; <br>    top_tb<span class="hljs-variable">.rx_dv</span> &lt;= <span class="hljs-number">1&#x27;b0</span>;<br>    <span class="hljs-keyword">while</span>(!top_tb<span class="hljs-variable">.rst_n</span>)<br>       @(<span class="hljs-keyword">posedge</span> top_tb<span class="hljs-variable">.clk</span>);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++)<span class="hljs-keyword">begin</span><br>       @(<span class="hljs-keyword">posedge</span> top_tb<span class="hljs-variable">.clk</span>);<br>       top_tb<span class="hljs-variable">.rxd</span> &lt;= $urandom_range(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>);<br>       top_tb<span class="hljs-variable">.rx_dv</span> &lt;= <span class="hljs-number">1&#x27;b1</span>;<br>       `uvm_info(<span class="hljs-string">&quot;my_driver&quot;</span>, <span class="hljs-string">&quot;data is drived&quot;</span>, UVM_LOW)<br>       <span class="hljs-comment">//uvm_info宏打印信息</span><br>   <span class="hljs-keyword">end</span><br>   @(<span class="hljs-keyword">posedge</span> top_tb<span class="hljs-variable">.clk</span>);<br>   top_tb<span class="hljs-variable">.rx_dv</span> &lt;= <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">endtask</span><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>

<p><strong>dut</strong></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">module</span> dut(clk,<br>           rst_n, <br>           rxd,<br>           rx_dv,<br>           txd,<br>           tx_en);<br><span class="hljs-keyword">input</span> clk;<br><span class="hljs-keyword">input</span> rst_n;<br><span class="hljs-keyword">input</span>[<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] rxd;<br><span class="hljs-keyword">input</span> rx_dv;<br><span class="hljs-keyword">output</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] txd;<br><span class="hljs-keyword">output</span> tx_en;<br><br><span class="hljs-keyword">reg</span>[<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] txd;<br><span class="hljs-keyword">reg</span> tx_en;<br><br><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk) <span class="hljs-keyword">begin</span><br>   	<span class="hljs-keyword">if</span>(!rst_n) <span class="hljs-keyword">begin</span><br>      	txd &lt;= <span class="hljs-number">8&#x27;b0</span>;<br>      	tx_en &lt;= <span class="hljs-number">1&#x27;b0</span>;<br>   	<span class="hljs-keyword">end</span><br>   	<span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span><br>      	txd &lt;= rxd;<br>      	tx_en &lt;= rx_dv;<br>   	<span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br><span class="hljs-keyword">endmodule</span><br><br></code></pre></td></tr></table></figure>

<p><strong>top_tb.sv</strong></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">timescale</span> 1ns/1ps</span><br><span class="hljs-meta">`<span class="hljs-keyword">include</span> &quot;uvm_macros.svh&quot;</span><br><br><span class="hljs-keyword">import</span> uvm_pkg::*;<br><span class="hljs-meta">`<span class="hljs-keyword">include</span> &quot;my_driver.sv&quot;</span><br><br><span class="hljs-keyword">module</span> top_tb;<br><br><span class="hljs-keyword">reg</span> clk;<br><span class="hljs-keyword">reg</span> rst_n;<br><span class="hljs-keyword">reg</span>[<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] rxd;<br><span class="hljs-keyword">reg</span> rx_dv;<br><span class="hljs-keyword">wire</span>[<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] txd;<br><span class="hljs-keyword">wire</span> tx_en;<br><br>dut my_dut(<span class="hljs-variable">.clk</span>(clk),<br>           <span class="hljs-variable">.rst_n</span>(rst_n),<br>           <span class="hljs-variable">.rxd</span>(rxd),<br>           <span class="hljs-variable">.rx_dv</span>(rx_dv),<br>           <span class="hljs-variable">.txd</span>(txd),<br>           <span class="hljs-variable">.tx_en</span>(tx_en));<br><br><span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span><br>    my_driver drv;   <span class="hljs-comment">//声明一个类</span><br>    drv = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;drv&quot;</span>, <span class="hljs-literal">null</span>);  <span class="hljs-comment">//调用构造函数</span><br>    drv<span class="hljs-variable">.main_phase</span>(<span class="hljs-literal">null</span>);  <span class="hljs-comment">//调用类方法</span><br>    <span class="hljs-built_in">$finish</span>(); <br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span><br>   clk = <span class="hljs-number">0</span>;<br>   <span class="hljs-keyword">forever</span> <span class="hljs-keyword">begin</span><br>      #<span class="hljs-number">100</span> clk = ~clk;<br>   <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span><br>   rst_n = <span class="hljs-number">1&#x27;b0</span>;<br>   #<span class="hljs-number">1000</span>;<br>   rst_n = <span class="hljs-number">1&#x27;b1</span>;<br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">endmodule</span><br></code></pre></td></tr></table></figure>

<h3 id="factory机制，工厂模式，objection机制"><a href="#factory机制，工厂模式，objection机制" class="headerlink" title="factory机制，工厂模式，objection机制"></a>factory机制，工厂模式，objection机制</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> MY_DRIVER__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> MY_DRIVER__SV</span><br><span class="hljs-keyword">class</span> my_driver <span class="hljs-keyword">extends</span> uvm_driver;<br>    `uvm_component_utils(my_driver) <span class="hljs-comment">//使用这个宏注册这个类，只有注册过的类才能使用工厂模式</span><br>   	<span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name = <span class="hljs-string">&quot;my_driver&quot;</span>, uvm_component parent = <span class="hljs-literal">null</span>);<br>      	<span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);<br>      	`uvm_info(<span class="hljs-string">&quot;my_driver&quot;</span>, <span class="hljs-string">&quot;new is called&quot;</span>, UVM_LOW);<br>   	<span class="hljs-keyword">endfunction</span><br>   	<span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">task</span> main_phase(uvm_phase phase);<br><span class="hljs-keyword">endclass</span><br><br><span class="hljs-keyword">task</span> my_driver::main_phase(uvm_phase phase);<br>    phase<span class="hljs-variable">.raise_objection</span>(<span class="hljs-keyword">this</span>); <span class="hljs-comment">//检查到提起objection，才会开启当前phase，这个语句必须在第一个消耗仿真时间的语句前</span><br>   	`uvm_info(<span class="hljs-string">&quot;my_driver&quot;</span>, <span class="hljs-string">&quot;main_phase is called&quot;</span>, UVM_LOW);<br>   	top_tb<span class="hljs-variable">.rxd</span> &lt;= <span class="hljs-number">8&#x27;b0</span>; <br>   	top_tb<span class="hljs-variable">.rx_dv</span> &lt;= <span class="hljs-number">1&#x27;b0</span>;<br>   	<span class="hljs-keyword">while</span>(!top_tb<span class="hljs-variable">.rst_n</span>)<br>      	@(<span class="hljs-keyword">posedge</span> top_tb<span class="hljs-variable">.clk</span>);<br>   	<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++)<span class="hljs-keyword">begin</span><br>      	@(<span class="hljs-keyword">posedge</span> top_tb<span class="hljs-variable">.clk</span>);<br>      	top_tb<span class="hljs-variable">.rxd</span> &lt;= $urandom_range(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>);<br>      	top_tb<span class="hljs-variable">.rx_dv</span> &lt;= <span class="hljs-number">1&#x27;b1</span>;<br>      	`uvm_info(<span class="hljs-string">&quot;my_driver&quot;</span>, <span class="hljs-string">&quot;data is drived&quot;</span>, UVM_LOW);<br>   	<span class="hljs-keyword">end</span><br>   	@(<span class="hljs-keyword">posedge</span> top_tb<span class="hljs-variable">.clk</span>);<br>   	top_tb<span class="hljs-variable">.rx_dv</span> &lt;= <span class="hljs-number">1&#x27;b0</span>;<br>    phase<span class="hljs-variable">.drop_objection</span>(<span class="hljs-keyword">this</span>); <span class="hljs-comment">//撤销objection，终止当前phase</span><br><span class="hljs-keyword">endtask</span><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>
<p>创建实例并调用其main_phase</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span><br>    run_test(<span class="hljs-string">&quot;my_driver&quot;</span>); <span class="hljs-comment">//传递的参数是字符串，创建这个类代表的一个实例</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>



<p>run_phase和12个细分phase；12个phase分为4个组：reset、 configure、main、shutdown；（run-time phase）</p>
<p>reset_phase对DUT进行复位、初始化等操作； </p>
<p>configure_phase则进行DUT的配置； </p>
<p>main_phase完成DUT的运行； </p>
<p>shutdown_phase做一些与DUT断电 相关的操作。</p>
<p>以下内容省略，查阅PPT</p>
<ul>
<li>phase的执行顺序</li>
<li>run_phase与run-time phase的区别</li>
</ul>
<h3 id="virtual-interface，config-db机制"><a href="#virtual-interface，config-db机制" class="headerlink" title="virtual interface，config_db机制"></a>virtual interface，config_db机制</h3><p>使用 virtual interface 尽量消除在验证平台中的绝对路径。增加验证平台的可移植性。</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> MY_IF__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> MY_IF__SV</span><br><br><span class="hljs-keyword">interface</span> my_if(<span class="hljs-keyword">input</span> clk, <span class="hljs-keyword">input</span> rst_n);<br>    <span class="hljs-keyword">logic</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] data; <br>   	<span class="hljs-keyword">logic</span> valid; <br><span class="hljs-keyword">endinterface</span><br><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>

<p><strong>top_tb.sv</strong></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">timescale</span> 1ns/1ps</span><br><span class="hljs-meta">`<span class="hljs-keyword">include</span> &quot;uvm_macros.svh&quot;</span><br><br><span class="hljs-keyword">import</span> uvm_pkg::*;<br><span class="hljs-meta">`<span class="hljs-keyword">include</span> &quot;my_if.sv&quot;</span><br><span class="hljs-meta">`<span class="hljs-keyword">include</span> &quot;my_driver.sv&quot;</span><br><br><span class="hljs-keyword">module</span> top_tb;<br><br><span class="hljs-keyword">reg</span> clk;<br><span class="hljs-keyword">reg</span> rst_n;<br><span class="hljs-keyword">reg</span>[<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] rxd;<br><span class="hljs-keyword">reg</span> rx_dv;<br><span class="hljs-keyword">wire</span>[<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] txd;<br><span class="hljs-keyword">wire</span> tx_en;<br><br>my_if input_if(clk, rst_n);<br>my_if output_if(clk, rst_n);<br><br>dut my_dut(<span class="hljs-variable">.clk</span>(clk),<br>           <span class="hljs-variable">.rst_n</span>(rst_n),<br>           <span class="hljs-variable">.rxd</span>(input_if<span class="hljs-variable">.data</span>),<br>           <span class="hljs-variable">.rx_dv</span>(input_if<span class="hljs-variable">.valid</span>),<br>           <span class="hljs-variable">.txd</span>(output_if<span class="hljs-variable">.data</span>),<br>           <span class="hljs-variable">.tx_en</span>(output_if<span class="hljs-variable">.valid</span>));<br><br><span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span><br>   clk = <span class="hljs-number">0</span>;<br>   <span class="hljs-keyword">forever</span> <span class="hljs-keyword">begin</span><br>      #<span class="hljs-number">100</span> clk = ~clk; <br>   <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span><br>   	rst_n = <span class="hljs-number">1&#x27;b0</span>; <br>   	#<span class="hljs-number">1000</span>;<br>   	rst_n = <span class="hljs-number">1&#x27;b1</span>; <br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span><br>   	run_test(<span class="hljs-string">&quot;my_driver&quot;</span>);<br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span><br>    <span class="hljs-comment">//对my_if接口传递参数类型，虚接口名称为vif，将input_if连接到vif</span><br>    <span class="hljs-comment">//set的四个参数，</span><br>    <span class="hljs-comment">//UVM通过run_test语句创建一个名字为uvm_test_top的实例，</span><br>    <span class="hljs-comment">//无论传递给run_test的参数是什么，创建的实例的名字都为uvm_test_top</span><br>   	uvm_config_db<span class="hljs-variable">#(virtual my_if)::set(null, &quot;uvm_test_top&quot;, &quot;vif&quot;, input_if)</span>;<br>    uvm_config_db<span class="hljs-variable">#(int)::set(null, &quot;uvm_test_top&quot;, &quot;var1&quot;, 100)</span>;<br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">endmodule</span><br></code></pre></td></tr></table></figure>



<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> MY_DRIVER__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> MY_DRIVER__SV</span><br><span class="hljs-keyword">class</span> my_driver <span class="hljs-keyword">extends</span> uvm_driver;<br>    <br><br>   	<span class="hljs-keyword">virtual</span> my_if vif; <span class="hljs-comment">//在driver类中声明virtual interface</span><br>    <span class="hljs-keyword">int</span> var1;<br><br>   	`uvm_component_utils(my_driver)<br>   	<span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name = <span class="hljs-string">&quot;my_driver&quot;</span>, uvm_component parent = <span class="hljs-literal">null</span>);<br>      	<span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);<br>      	`uvm_info(<span class="hljs-string">&quot;my_driver&quot;</span>, <span class="hljs-string">&quot;new is called&quot;</span>, UVM_LOW);<br>   	<span class="hljs-keyword">endfunction</span><br>	<span class="hljs-comment">//bulid是一个函数pahse，不消耗仿真时间</span><br>   	<span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase);<br>      	<span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br>      	`uvm_info(<span class="hljs-string">&quot;my_driver&quot;</span>, <span class="hljs-string">&quot;build_phase is called&quot;</span>, UVM_LOW);<br>      	<span class="hljs-keyword">if</span>(!uvm_config_db<span class="hljs-variable">#(virtual my_if)::get(this, &quot;&quot;, &quot;vif&quot;, vif))</span><br>            <span class="hljs-comment">//与uvm_info宏不同的是，当uvm_fatal打印第二个参数所示的信息后，会直接调用Verilog的finish函数来结束仿真</span><br>            <span class="hljs-comment">//uvm_fatal的出现表示验证平台出现了重大问题而无法继续下去</span><br>         	`uvm_fatal(<span class="hljs-string">&quot;my_driver&quot;</span>, <span class="hljs-string">&quot;virtual interface must be set for vif!!!&quot;</span>)<br>        <span class="hljs-keyword">if</span>(!uvm_config_db<span class="hljs-variable">#(int)::get(this, &quot;&quot;, &quot;var1, var1)</span><br>            `uvm_fatal(<span class="hljs-string">&quot;my_driver&quot;</span>, <span class="hljs-string">&quot;var must be set!!!&quot;</span>)<br>   	<span class="hljs-keyword">endfunction</span><br>   	<span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">task</span> main_phase(uvm_phase phase);<br><span class="hljs-keyword">endclass</span><br><br><span class="hljs-keyword">task</span> my_driver::main_phase(uvm_phase phase);<br>   	phase<span class="hljs-variable">.raise_objection</span>(<span class="hljs-keyword">this</span>);<br>   	`uvm_info(<span class="hljs-string">&quot;my_driver&quot;</span>, <span class="hljs-string">&quot;main_phase is called&quot;</span>, UVM_LOW);<br>   	vif<span class="hljs-variable">.data</span> &lt;= <span class="hljs-number">8&#x27;b0</span>;  <span class="hljs-comment">//在task中直接使用接口驱动信号</span><br>   	vif<span class="hljs-variable">.valid</span> &lt;= <span class="hljs-number">1&#x27;b0</span>;<br>   	<span class="hljs-keyword">while</span>(!vif<span class="hljs-variable">.rst_n</span>)<br>      	@(<span class="hljs-keyword">posedge</span> vif<span class="hljs-variable">.clk</span>);<br>   	<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++)<span class="hljs-keyword">begin</span><br>      	@(<span class="hljs-keyword">posedge</span> vif<span class="hljs-variable">.clk</span>);<br>      	vif<span class="hljs-variable">.data</span> &lt;= $urandom_range(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>);<br>      	vif<span class="hljs-variable">.valid</span> &lt;= <span class="hljs-number">1&#x27;b1</span>;<br>      	`uvm_info(<span class="hljs-string">&quot;my_driver&quot;</span>, <span class="hljs-string">&quot;data is drived&quot;</span>, UVM_LOW);<br>   	<span class="hljs-keyword">end</span><br>   	@(<span class="hljs-keyword">posedge</span> vif<span class="hljs-variable">.clk</span>);<br>   	vif<span class="hljs-variable">.valid</span> &lt;= <span class="hljs-number">1&#x27;b0</span>;<br>   	phase<span class="hljs-variable">.drop_objection</span>(<span class="hljs-keyword">this</span>);<br><span class="hljs-keyword">endtask</span><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>



<p>uvm_config_db #（virtual my_if）则是一个参数化的类， 其参数就是要传递参数的类型，这里是 virtual my_if</p>
<p>config_db 的 set 和 get 函数都有四个参数，这两个函数的第三个参数必须完全一致</p>
<p>第四个参数表示要传递的变量，set 处是 top 中例化的 input_if，get 处是 my_driver 中声明的 vif</p>
<p>第一个和第二个参数联合起来组成目标路径</p>
<h2 id="Transcation"><a href="#Transcation" class="headerlink" title="Transcation"></a>Transcation</h2><p>在UVM平台，各个组件之间信息的传递是 基于 transaction 的</p>
<p>transcation</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> MY_TRANSACTION__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> MY_TRANSACTION__SV</span><br><br><span class="hljs-keyword">class</span> my_transaction <span class="hljs-keyword">extends</span> uvm_sequence_item;<br><br>    <span class="hljs-keyword">rand</span> <span class="hljs-keyword">bit</span>[<span class="hljs-number">47</span>:<span class="hljs-number">0</span>] dmac; <span class="hljs-comment">//使用rand/randc修饰的变量，在每次调用randomize()之后，会产生一个新的随机值</span><br>   	<span class="hljs-keyword">rand</span> <span class="hljs-keyword">bit</span>[<span class="hljs-number">47</span>:<span class="hljs-number">0</span>] smac;<br>   	<span class="hljs-keyword">rand</span> <span class="hljs-keyword">bit</span>[<span class="hljs-number">15</span>:<span class="hljs-number">0</span>] ether_type;<br>   	<span class="hljs-keyword">rand</span> <span class="hljs-keyword">byte</span>      pload[];<br>   	<span class="hljs-keyword">rand</span> <span class="hljs-keyword">bit</span>[<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] crc;<br><br>    <span class="hljs-keyword">constraint</span> pload_cons&#123; <span class="hljs-comment">//约束块内，一个表达式一个关系操作符</span><br>      	pload<span class="hljs-variable">.size</span> &gt;= <span class="hljs-number">46</span>;<br>      	pload<span class="hljs-variable">.size</span> &lt;= <span class="hljs-number">1500</span>;<br>   	&#125;<br><br>   	<span class="hljs-keyword">function</span> <span class="hljs-keyword">bit</span>[<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] calc_crc();<br>      	<span class="hljs-keyword">return</span> <span class="hljs-number">32&#x27;h0</span>;<br>   	<span class="hljs-keyword">endfunction</span><br>   	<span class="hljs-comment">// 实例的randomize函数被调用后，post_randomize会紧随其后无条件地被调用</span><br>   	<span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> post_randomize();<br>      	crc = calc_crc;<br>   	<span class="hljs-keyword">endfunction</span><br><br>    `uvm_object_utils(my_transaction) <span class="hljs-comment">//使用了uvm_object_utils实现factory机制</span><br><br>   	<span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name = <span class="hljs-string">&quot;my_transaction&quot;</span>);<br>      	<span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>();<br>   	<span class="hljs-keyword">endfunction</span><br><span class="hljs-keyword">endclass</span><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>

<p>在my_driver中实现基于transaction的驱动</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> MY_DRIVER__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> MY_DRIVER__SV</span><br><span class="hljs-keyword">class</span> my_driver <span class="hljs-keyword">extends</span> uvm_driver;<br>   	<span class="hljs-keyword">virtual</span> my_if vif;<br><br>   	`uvm_component_utils(my_driver)<br>   	<span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name = <span class="hljs-string">&quot;my_driver&quot;</span>, uvm_component parent = <span class="hljs-literal">null</span>);<br>      	<span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);<br>   	<span class="hljs-keyword">endfunction</span><br><br>   	<span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase);<br>      	<span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br>      	<span class="hljs-keyword">if</span>(!uvm_config_db<span class="hljs-variable">#(virtual my_if)::get(this, &quot;&quot;, &quot;vif&quot;, vif))</span><br>         	`uvm_fatal(<span class="hljs-string">&quot;my_driver&quot;</span>, <span class="hljs-string">&quot;virtual interface must be set for vif!!!&quot;</span>)<br>   	<span class="hljs-keyword">endfunction</span><br><br>    <span class="hljs-keyword">extern</span> <span class="hljs-keyword">task</span> main_phase(uvm_phase phase); <span class="hljs-comment">//main_phase产生transaction并调用dirve_one_pkt;</span><br>    <span class="hljs-keyword">extern</span> <span class="hljs-keyword">task</span> drive_one_pkt(my_transaction tr); <span class="hljs-comment">//dirve_one_pkt驱动具体信号</span><br><span class="hljs-keyword">endclass</span><br><br><span class="hljs-keyword">task</span> my_driver::main_phase(uvm_phase phase);<br>    <span class="hljs-comment">//产生激励：产生class my_transaction的实例</span><br>   	my_transaction tr; <span class="hljs-comment">//声明一个transaction</span><br>   	phase<span class="hljs-variable">.raise_objection</span>(<span class="hljs-keyword">this</span>);<br>   	vif<span class="hljs-variable">.data</span> &lt;= <span class="hljs-number">8&#x27;b0</span>; <span class="hljs-comment">//对DUT的信号初始化，等待reset</span><br>   	vif<span class="hljs-variable">.valid</span> &lt;= <span class="hljs-number">1&#x27;b0</span>;<br>   	<span class="hljs-keyword">while</span>(!vif<span class="hljs-variable">.rst_n</span>)<br>      	@(<span class="hljs-keyword">posedge</span> vif<span class="hljs-variable">.clk</span>);<br>   	<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) <span class="hljs-keyword">begin</span> <br>        tr = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;tr&quot;</span>); <span class="hljs-comment">//创建一个实例</span><br>        <span class="hljs-keyword">assert</span>(tr<span class="hljs-variable">.randomize</span>() <span class="hljs-keyword">with</span> &#123;pload<span class="hljs-variable">.size</span> == <span class="hljs-number">200</span>;&#125;); <span class="hljs-comment">//randomize随机化tr的地址、数据等</span><br>        <span class="hljs-comment">//优先级更高的附加约束：200byte</span><br>        <span class="hljs-comment">//断言，检查约束是否成功，如果失败，则立即报错</span><br>      	drive_one_pkt(tr);<br>   	<span class="hljs-keyword">end</span><br>   	<span class="hljs-keyword">repeat</span>(<span class="hljs-number">5</span>) @(<span class="hljs-keyword">posedge</span> vif<span class="hljs-variable">.clk</span>);<br>   	phase<span class="hljs-variable">.drop_objection</span>(<span class="hljs-keyword">this</span>);<br><span class="hljs-keyword">endtask</span><br><br><span class="hljs-keyword">task</span> my_driver::drive_one_pkt(my_transaction tr);<br>   <span class="hljs-comment">//驱动激励：根据transaction实例，针对DUT端口进行信号级的操作</span><br>   <span class="hljs-keyword">bit</span> [<span class="hljs-number">47</span>:<span class="hljs-number">0</span>] tmp_data;<br>   <span class="hljs-keyword">bit</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] data_q[$]; <br>   <span class="hljs-comment">//将transaction中各变量打包到data_q中</span><br>   <span class="hljs-comment">//push dmac to data_q</span><br>   tmp_data = tr<span class="hljs-variable">.dmac</span>;<br>   <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">6</span>; i++) <span class="hljs-keyword">begin</span><br>      data_q<span class="hljs-variable">.push_back</span>(tmp_data[<span class="hljs-number">7</span>:<span class="hljs-number">0</span>]);<br>      tmp_data = (tmp_data &gt;&gt; <span class="hljs-number">8</span>);<br>   <span class="hljs-keyword">end</span><br>   <span class="hljs-comment">//push smac to data_q</span><br>   tmp_data = tr<span class="hljs-variable">.smac</span>;<br>   <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">6</span>; i++) <span class="hljs-keyword">begin</span><br>      data_q<span class="hljs-variable">.push_back</span>(tmp_data[<span class="hljs-number">7</span>:<span class="hljs-number">0</span>]);<br>      tmp_data = (tmp_data &gt;&gt; <span class="hljs-number">8</span>);<br>   <span class="hljs-keyword">end</span><br>   <span class="hljs-comment">//push ether_type to data_q</span><br>   tmp_data = tr<span class="hljs-variable">.ether_type</span>;<br>   <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) <span class="hljs-keyword">begin</span><br>      data_q<span class="hljs-variable">.push_back</span>(tmp_data[<span class="hljs-number">7</span>:<span class="hljs-number">0</span>]);<br>      tmp_data = (tmp_data &gt;&gt; <span class="hljs-number">8</span>);<br>   <span class="hljs-keyword">end</span><br>   <span class="hljs-comment">//push payload to data_q</span><br>   <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; tr<span class="hljs-variable">.pload</span><span class="hljs-variable">.size</span>; i++) <span class="hljs-keyword">begin</span><br>      data_q<span class="hljs-variable">.push_back</span>(tr<span class="hljs-variable">.pload</span>[i]);<br>   <span class="hljs-keyword">end</span><br>   <span class="hljs-comment">//push crc to data_q</span><br>   tmp_data = tr<span class="hljs-variable">.crc</span>;<br>   <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) <span class="hljs-keyword">begin</span><br>      data_q<span class="hljs-variable">.push_back</span>(tmp_data[<span class="hljs-number">7</span>:<span class="hljs-number">0</span>]);<br>      tmp_data = (tmp_data &gt;&gt; <span class="hljs-number">8</span>);<br>   <span class="hljs-keyword">end</span><br><br>   `uvm_info(<span class="hljs-string">&quot;my_driver&quot;</span>, <span class="hljs-string">&quot;begin to drive one pkt&quot;</span>, UVM_LOW);<br>   <span class="hljs-keyword">repeat</span>(<span class="hljs-number">3</span>) @(<span class="hljs-keyword">posedge</span> vif<span class="hljs-variable">.clk</span>);<br><br>   <span class="hljs-keyword">while</span>(data_q<span class="hljs-variable">.size</span>() &gt; <span class="hljs-number">0</span>) <span class="hljs-keyword">begin</span> <span class="hljs-comment">//将全部data_q数据直接端口操作</span><br>      @(<span class="hljs-keyword">posedge</span> vif<span class="hljs-variable">.clk</span>);<br>      vif<span class="hljs-variable">.valid</span> &lt;= <span class="hljs-number">1&#x27;b1</span>;<br>      vif<span class="hljs-variable">.data</span> &lt;= data_q<span class="hljs-variable">.pop_front</span>(); <br>   <span class="hljs-keyword">end</span><br><br>   @(<span class="hljs-keyword">posedge</span> vif<span class="hljs-variable">.clk</span>);<br>   vif<span class="hljs-variable">.valid</span> &lt;= <span class="hljs-number">1&#x27;b0</span>;<br>   `uvm_info(<span class="hljs-string">&quot;my_driver&quot;</span>, <span class="hljs-string">&quot;end drive one pkt&quot;</span>, UVM_LOW);<br><span class="hljs-keyword">endtask</span><br><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br><br></code></pre></td></tr></table></figure>



<h2 id="env"><a href="#env" class="headerlink" title="env"></a>env</h2><p>在平台中除了driver外，还有其他组件，引入一个容器：uvm_env，将 其他组件容纳到env中。再使用 run_test(“env”);</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> MY_ENV__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> MY_ENV__SV</span><br><br><span class="hljs-keyword">class</span> my_env <span class="hljs-keyword">extends</span> uvm_env;<br><br>   my_driver drv;<br><br>   <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name = <span class="hljs-string">&quot;my_env&quot;</span>, uvm_component parent);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);<br>   <span class="hljs-keyword">endfunction</span><br><br>   <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br>      drv = my_driver::type_id::create(<span class="hljs-string">&quot;drv&quot;</span>, <span class="hljs-keyword">this</span>); <span class="hljs-comment">//使用函数type_name::type_id::create，来进行实例化</span><br>   <span class="hljs-keyword">endfunction</span><br><br>   `uvm_component_utils(my_env) <span class="hljs-comment">//uvm_component_utils宏来实现factory的注册</span><br><span class="hljs-keyword">endclass</span><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br><br></code></pre></td></tr></table></figure>

<p>由run_test创建的实例是树根（ 这里是my_env），其名字是固定的 uvm_test_top</p>
<p>长出枝叶的过程需要在my_env 的build_phase中手动实现；平台 build执行顺序是从树根到树叶</p>
<p>无论是树根还是树叶，都必须是 uvm_component或者其派生类</p>
<p>virtual interface的传递，路劲要改变</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs verilog">uvm_config_db<span class="hljs-variable">#(virtual my_if)::set(null, &quot;uvm_test_top.drv&quot;, &quot;vif&quot;, input_if)</span>; <span class="hljs-comment">//drv是env中例化的driver的名字</span><br></code></pre></td></tr></table></figure>



<h2 id="monitor"><a href="#monitor" class="headerlink" title="monitor"></a>monitor</h2><p>作用：实现监控DUT的行为， 包括输入和输出；（注意driver 与RM的连接）</p>
<p>方式：收集DUT的端口数据， 并将其转换成transaction交给 后续的组件如reference model、 scoreboard等处理。</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> MY_MONITOR__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> MY_MONITOR__SV</span><br><span class="hljs-keyword">class</span> my_monitor <span class="hljs-keyword">extends</span> uvm_monitor;<br><br>   <span class="hljs-keyword">virtual</span> my_if vif;<br><br>   `uvm_component_utils(my_monitor)<br>   <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name = <span class="hljs-string">&quot;my_monitor&quot;</span>, uvm_component parent = <span class="hljs-literal">null</span>);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);<br>   <span class="hljs-keyword">endfunction</span><br><br>   <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br>      <span class="hljs-keyword">if</span>(!uvm_config_db<span class="hljs-variable">#(virtual my_if)::get(this, &quot;&quot;, &quot;vif&quot;, vif))</span><br>         `uvm_fatal(<span class="hljs-string">&quot;my_monitor&quot;</span>, <span class="hljs-string">&quot;virtual interface must be set for vif!!!&quot;</span>)<br>   <span class="hljs-keyword">endfunction</span><br><br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">task</span> main_phase(uvm_phase phase); <span class="hljs-comment">//main_phase声明transaction,并调用collect_one_pkt</span><br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">task</span> collect_one_pkt(my_transaction tr); <span class="hljs-comment">//收集transaction</span><br><span class="hljs-keyword">endclass</span><br><br><span class="hljs-keyword">task</span> my_monitor::main_phase(uvm_phase phase);<br>   my_transaction tr;<br>   <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">begin</span> <span class="hljs-comment">//需要时刻收集数据，永不停歇；（其他单元控制objection</span><br>      tr = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;tr&quot;</span>);<br>      collect_one_pkt(tr);<br>   <span class="hljs-keyword">end</span><br><span class="hljs-keyword">endtask</span><br><br><span class="hljs-keyword">task</span> my_monitor::collect_one_pkt(my_transaction tr); <span class="hljs-comment">//将数据收集到一个transaction；实际上是driver的逆过程</span><br><br>   <span class="hljs-keyword">bit</span>[<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] data_q[$]; <br>   <span class="hljs-keyword">int</span> psize;<br>   <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">begin</span><br>      @(<span class="hljs-keyword">posedge</span> vif<span class="hljs-variable">.clk</span>);<br>      <span class="hljs-keyword">if</span>(vif<span class="hljs-variable">.valid</span>) <span class="hljs-keyword">break</span>;<br>   <span class="hljs-keyword">end</span><br><br>   `uvm_info(<span class="hljs-string">&quot;my_monitor&quot;</span>, <span class="hljs-string">&quot;begin to collect one pkt&quot;</span>, UVM_LOW);<br>   <span class="hljs-keyword">while</span>(vif<span class="hljs-variable">.valid</span>) <span class="hljs-keyword">begin</span><br>      data_q<span class="hljs-variable">.push_back</span>(vif<span class="hljs-variable">.data</span>);<br>      @(<span class="hljs-keyword">posedge</span> vif<span class="hljs-variable">.clk</span>);<br>   <span class="hljs-keyword">end</span><br>   <span class="hljs-comment">//pop dmac</span><br>   <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">6</span>; i++) <span class="hljs-keyword">begin</span><br>      tr<span class="hljs-variable">.dmac</span> = &#123;tr<span class="hljs-variable">.dmac</span>[<span class="hljs-number">39</span>:<span class="hljs-number">0</span>], data_q<span class="hljs-variable">.pop_front</span>()&#125;;<br>   <span class="hljs-keyword">end</span><br>   <span class="hljs-comment">//pop smac</span><br>   <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">6</span>; i++) <span class="hljs-keyword">begin</span><br>      tr<span class="hljs-variable">.smac</span> = &#123;tr<span class="hljs-variable">.smac</span>[<span class="hljs-number">39</span>:<span class="hljs-number">0</span>], data_q<span class="hljs-variable">.pop_front</span>()&#125;;<br>   <span class="hljs-keyword">end</span><br>   <span class="hljs-comment">//pop ether_type</span><br>   <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) <span class="hljs-keyword">begin</span><br>      tr<span class="hljs-variable">.ether_type</span> = &#123;tr<span class="hljs-variable">.ether_type</span>[<span class="hljs-number">7</span>:<span class="hljs-number">0</span>], data_q<span class="hljs-variable">.pop_front</span>()&#125;;<br>   <span class="hljs-keyword">end</span><br><br>   psize = data_q<span class="hljs-variable">.size</span>() - <span class="hljs-number">4</span>;<br>   tr<span class="hljs-variable">.pload</span> = <span class="hljs-keyword">new</span>[psize];<br>   <span class="hljs-comment">//pop payload</span><br>   <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; psize; i++) <span class="hljs-keyword">begin</span><br>      tr<span class="hljs-variable">.pload</span>[i] = data_q<span class="hljs-variable">.pop_front</span>();<br>   <span class="hljs-keyword">end</span><br>   <span class="hljs-comment">//pop crc</span><br>   <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) <span class="hljs-keyword">begin</span><br>      tr<span class="hljs-variable">.crc</span> = &#123;tr<span class="hljs-variable">.crc</span>[<span class="hljs-number">23</span>:<span class="hljs-number">0</span>], data_q<span class="hljs-variable">.pop_front</span>()&#125;;<br>   <span class="hljs-keyword">end</span><br>   `uvm_info(<span class="hljs-string">&quot;my_monitor&quot;</span>, <span class="hljs-string">&quot;end collect one pkt, print it:&quot;</span>, UVM_LOW);<br>    tr<span class="hljs-variable">.my_print</span>();<br><span class="hljs-keyword">endtask</span><br><br><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br><br></code></pre></td></tr></table></figure>

<p>在env中例化monitor</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">class</span> my_env <span class="hljs-keyword">extends</span> uvm_env;<br><br>   my_driver drv;<br>   my_monitor i_mon;<br>   my_monitor o_mon;<br><br>   <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name = <span class="hljs-string">&quot;my_env&quot;</span>, uvm_component parent);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);<br>   <span class="hljs-keyword">endfunction</span><br><br>   <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br>      drv = my_driver::type_id::create(<span class="hljs-string">&quot;drv&quot;</span>, <span class="hljs-keyword">this</span>); <br>      i_mon = my_monitor::type_id::create(<span class="hljs-string">&quot;i_mon&quot;</span>, <span class="hljs-keyword">this</span>);<br>      o_mon = my_monitor::type_id::create(<span class="hljs-string">&quot;o_mon&quot;</span>, <span class="hljs-keyword">this</span>);<br>   <span class="hljs-keyword">endfunction</span><br><br>   `uvm_component_utils(my_env)<br><span class="hljs-keyword">endclass</span><br></code></pre></td></tr></table></figure>

<p>接口传递</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span><br>   uvm_config_db<span class="hljs-variable">#(virtual my_if)::set(null, &quot;uvm_test_top.drv&quot;, &quot;vif&quot;, input_if)</span>;<br>    uvm_config_db<span class="hljs-variable">#(virtual my_if)::set(null, &quot;uvm_test_top.i_mon&quot;, &quot;vif&quot;, input_if)</span>; <span class="hljs-comment">//收集DUT输入端口的事务</span><br>    uvm_config_db<span class="hljs-variable">#(virtual my_if)::set(null, &quot;uvm_test_top.o_mon&quot;, &quot;vif&quot;, output_if)</span>; <span class="hljs-comment">//收集DUT输出端口</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<h2 id="uvm-agent-封装"><a href="#uvm-agent-封装" class="headerlink" title="uvm_agent 封装"></a>uvm_agent 封装</h2><p>agent实际上是UVM平台上基于协议的标准单元</p>
<p>UVM中agent通常上是一个三元组（sequencer、driver和 monitor）</p>
<p>sequencer产生激励， driver驱动激励</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> MY_AGENT__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> MY_AGENT__SV</span><br><br><span class="hljs-keyword">class</span> my_agent <span class="hljs-keyword">extends</span> uvm_agent ;<br>   my_driver     drv; <span class="hljs-comment">//声明一个driver</span><br>   my_monitor    mon; <span class="hljs-comment">//声明一个monitor</span><br>   <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name, uvm_component parent);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);<br>   <span class="hljs-keyword">endfunction</span> <br>   <br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase);<br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> connect_phase(uvm_phase phase);<br><br>   `uvm_component_utils(my_agent)<br><span class="hljs-keyword">endclass</span> <br><br><span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> my_agent::build_phase(uvm_phase phase);<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br>   <span class="hljs-keyword">if</span> (is_active == UVM_ACTIVE) <span class="hljs-keyword">begin</span> <span class="hljs-comment">//只有当is_active为UVM_ACTIVE是才需要driver，即DUT的输入端口</span><br>       drv = my_driver::type_id::create(<span class="hljs-string">&quot;drv&quot;</span>, <span class="hljs-keyword">this</span>);<br>   <span class="hljs-keyword">end</span><br>    mon = my_monitor::type_id::create(<span class="hljs-string">&quot;mon&quot;</span>, <span class="hljs-keyword">this</span>); <span class="hljs-comment">//输入输出端口均例化monitor</span><br><span class="hljs-keyword">endfunction</span> <br><br><span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> my_agent::connect_phase(uvm_phase phase);<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.connect_phase</span>(phase);<br><span class="hljs-keyword">endfunction</span><br><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>



<p>在env中直接例化agent，而不需要直接实例化driver和monitor了</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">class</span> my_env <span class="hljs-keyword">extends</span> uvm_env;<br><br>   my_agent  i_agt;<br>   my_agent  o_agt;<br>   <br>   <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name = <span class="hljs-string">&quot;my_env&quot;</span>, uvm_component parent);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);<br>   <span class="hljs-keyword">endfunction</span><br><br>   <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br>      i_agt = my_agent::type_id::create(<span class="hljs-string">&quot;i_agt&quot;</span>, <span class="hljs-keyword">this</span>);<br>      o_agt = my_agent::type_id::create(<span class="hljs-string">&quot;o_agt&quot;</span>, <span class="hljs-keyword">this</span>);<br>      i_agt<span class="hljs-variable">.is_active</span> = UVM_ACTIVE; <span class="hljs-comment">//输入端口需要driver</span><br>      o_agt<span class="hljs-variable">.is_active</span> = UVM_PASSIVE; <span class="hljs-comment">//输出端口只需要monitor</span><br>      <span class="hljs-comment">//is_active是uvm_agent的枚举型成员变量</span><br>      <span class="hljs-comment">//typedef enum bit &#123; UVM_PASSIVE=0, UVM_ACTIVE=1 &#125; uvm_active_passive_enum;</span><br>      <span class="hljs-comment">//UVM_ACTIVE意味着例化driver，UVM_PASSIVE意味着例化monitor</span><br>   <span class="hljs-keyword">endfunction</span><br>   `uvm_component_utils(my_env)<br><span class="hljs-keyword">endclass</span><br></code></pre></td></tr></table></figure>

<p>接口传递的路劲改变</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span><br>   uvm_config_db<span class="hljs-variable">#(virtual my_if)::set(null, &quot;uvm_test_top.i_agt.drv&quot;, &quot;vif&quot;, input_if)</span>;<br>   uvm_config_db<span class="hljs-variable">#(virtual my_if)::set(null, &quot;uvm_test_top.i_agt.mon&quot;, &quot;vif&quot;, input_if)</span>;<br>   uvm_config_db<span class="hljs-variable">#(virtual my_if)::set(null, &quot;uvm_test_top.o_agt.mon&quot;, &quot;vif&quot;, output_if)</span>;<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>



<h2 id="refrence-model"><a href="#refrence-model" class="headerlink" title="refrence model"></a>refrence model</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> MY_MODEL__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> MY_MODEL__SV</span><br><br><span class="hljs-keyword">class</span> my_model <span class="hljs-keyword">extends</span> uvm_component;<br>   <br>   uvm_blocking_get_port <span class="hljs-variable">#(my_transaction)</span>  port; <span class="hljs-comment">//声明一个端口，用于接收事务</span><br>   uvm_analysis_port <span class="hljs-variable">#(my_transaction)</span>  ap; <span class="hljs-comment">//声明一个端口，用于发送事务</span><br><br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name, uvm_component parent);<br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase);<br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span>  <span class="hljs-keyword">task</span> main_phase(uvm_phase phase);<br>   `uvm_component_utils(my_model)<br><span class="hljs-keyword">endclass</span> <br><br>       <br><span class="hljs-keyword">function</span> my_model::<span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name, uvm_component parent);<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);<br><span class="hljs-keyword">endfunction</span> <br><br>       <br><span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> my_model::build_phase(uvm_phase phase);<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br>    port = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;port&quot;</span>, <span class="hljs-keyword">this</span>); <span class="hljs-comment">//实例化端口</span><br>    ap = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;ap&quot;</span>, <span class="hljs-keyword">this</span>); <span class="hljs-comment">//实例化端口</span><br><span class="hljs-keyword">endfunction</span><br>       <br><span class="hljs-comment">//实现与DUT相同的功能，将输入的transaction复制一份，并发送出去</span><br><span class="hljs-keyword">task</span> my_model::main_phase(uvm_phase phase);<br>   my_transaction tr;<br>   my_transaction new_tr;<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.main_phase</span>(phase);<br>   <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">begin</span><br>      port<span class="hljs-variable">.get</span>(tr); <span class="hljs-comment">//***_get_port定义的get函数获取一个事务（从i端monitor）</span><br>      new_tr = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;new_tr&quot;</span>);<span class="hljs-comment">//实例化一个transaction</span><br>      new_tr<span class="hljs-variable">.my_copy</span>(tr); <span class="hljs-comment">//调用transaction的类方法，该方法在transaction中实现</span><br>      `uvm_info(<span class="hljs-string">&quot;my_model&quot;</span>, <span class="hljs-string">&quot;get one transaction, copy and print it:&quot;</span>, UVM_LOW)<br>      new_tr<span class="hljs-variable">.my_print</span>();<br>      ap<span class="hljs-variable">.write</span>(new_tr); <span class="hljs-comment">//***_analysis_port定义的write函数发送一个事务（到Scoreboard）</span><br>   <span class="hljs-keyword">end</span><br><span class="hljs-keyword">endtask</span><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>

<p>在agent端声明端口用于连接，在monitor中实例化一个端口</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">class</span> my_monitor <span class="hljs-keyword">extends</span> uvm_monitor;<br><br>   <span class="hljs-keyword">virtual</span> my_if vif;<br><br>   uvm_analysis_port <span class="hljs-variable">#(my_transaction)</span>  ap; <span class="hljs-comment">//声明一个端口用于发送</span><br>   <br>   `uvm_component_utils(my_monitor)<br>   <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name = <span class="hljs-string">&quot;my_monitor&quot;</span>, uvm_component parent = <span class="hljs-literal">null</span>);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);<br>   <span class="hljs-keyword">endfunction</span><br><br>   <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br>      <span class="hljs-keyword">if</span>(!uvm_config_db<span class="hljs-variable">#(virtual my_if)::get(this, &quot;&quot;, &quot;vif&quot;, vif))</span><br>         `uvm_fatal(<span class="hljs-string">&quot;my_monitor&quot;</span>, <span class="hljs-string">&quot;virtual interface must be set for vif!!!&quot;</span>)<br>      ap = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;ap&quot;</span>, <span class="hljs-keyword">this</span>); <span class="hljs-comment">//实例化一个端口</span><br>   <span class="hljs-keyword">endfunction</span><br><br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">task</span> main_phase(uvm_phase phase);<br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">task</span> collect_one_pkt(my_transaction tr);<br><span class="hljs-keyword">endclass</span><br><br><span class="hljs-keyword">task</span> my_monitor::main_phase(uvm_phase phase);<br>   my_transaction tr;<br>   <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">begin</span><br>      tr = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;tr&quot;</span>);<br>      collect_one_pkt(tr);<br>      ap<span class="hljs-variable">.write</span>(tr); <span class="hljs-comment">//将事务通过端口发送出去</span><br>   <span class="hljs-keyword">end</span><br><span class="hljs-keyword">endtask</span><br></code></pre></td></tr></table></figure>

<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">class</span> my_agent <span class="hljs-keyword">extends</span> uvm_agent ;<br>   my_driver     drv;<br>   my_monitor    mon;<br>   <br>   uvm_analysis_port <span class="hljs-variable">#(my_transaction)</span>  ap; <span class="hljs-comment">//声明一个端口，用于发送</span><br>   <br>   <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name, uvm_component parent);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);<br>   <span class="hljs-keyword">endfunction</span> <br>   <br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase);<br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> connect_phase(uvm_phase phase);<br><br>   `uvm_component_utils(my_agent)<br><span class="hljs-keyword">endclass</span> <br><br><br><span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> my_agent::build_phase(uvm_phase phase);<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br>   <span class="hljs-keyword">if</span> (is_active == UVM_ACTIVE) <span class="hljs-keyword">begin</span><br>       drv = my_driver::type_id::create(<span class="hljs-string">&quot;drv&quot;</span>, <span class="hljs-keyword">this</span>);<br>   <span class="hljs-keyword">end</span><br>   mon = my_monitor::type_id::create(<span class="hljs-string">&quot;mon&quot;</span>, <span class="hljs-keyword">this</span>);<br><span class="hljs-keyword">endfunction</span> <br><br><span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> my_agent::connect_phase(uvm_phase phase);<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.connect_phase</span>(phase);<br>   ap = mon<span class="hljs-variable">.ap</span>; <span class="hljs-comment">//直接幅值，没有实例化，相当于一个指针，指向monitor的端口</span><br><span class="hljs-keyword">endfunction</span><br></code></pre></td></tr></table></figure>

<p>在env中将agent端与refrence model端相连接</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">class</span> my_env <span class="hljs-keyword">extends</span> uvm_env;<br><br>   my_agent  i_agt;<br>   my_agent  o_agt;<br>   my_model  mdl;<br>   <br>   uvm_tlm_analysis_fifo <span class="hljs-variable">#(my_transaction)</span> agt_mdl_fifo; <span class="hljs-comment">//声明一个fifo</span><br>   <br>   <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name = <span class="hljs-string">&quot;my_env&quot;</span>, uvm_component parent);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);<br>   <span class="hljs-keyword">endfunction</span><br><br>   <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br>      i_agt = my_agent::type_id::create(<span class="hljs-string">&quot;i_agt&quot;</span>, <span class="hljs-keyword">this</span>);<br>      o_agt = my_agent::type_id::create(<span class="hljs-string">&quot;o_agt&quot;</span>, <span class="hljs-keyword">this</span>);<br>      i_agt<span class="hljs-variable">.is_active</span> = UVM_ACTIVE;<br>      o_agt<span class="hljs-variable">.is_active</span> = UVM_PASSIVE;<br>      mdl = my_model::type_id::create(<span class="hljs-string">&quot;mdl&quot;</span>, <span class="hljs-keyword">this</span>); <span class="hljs-comment">//实例化一个参考模型</span><br>      agt_mdl_fifo = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;agt_mdl_fifo&quot;</span>, <span class="hljs-keyword">this</span>); <span class="hljs-comment">//实例化一个fifo</span><br>   <span class="hljs-keyword">endfunction</span><br><br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> connect_phase(uvm_phase phase);<br>   <br>   `uvm_component_utils(my_env)<br><span class="hljs-keyword">endclass</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> my_env::connect_phase(uvm_phase phase);<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.connect_phase</span>(phase);<br>   i_agt<span class="hljs-variable">.ap</span><span class="hljs-variable">.connect</span>(agt_mdl_fifo<span class="hljs-variable">.analysis_export</span>); <span class="hljs-comment">//将输入端的monitor端口连接到fifo</span><br>   mdl<span class="hljs-variable">.port</span><span class="hljs-variable">.connect</span>(agt_mdl_fifo<span class="hljs-variable">.blocking_get_export</span>); <span class="hljs-comment">//将参考模型的输入端口连接到fifo</span><br><span class="hljs-keyword">endfunction</span><br></code></pre></td></tr></table></figure>

<h2 id="Scoreboard"><a href="#Scoreboard" class="headerlink" title="Scoreboard"></a>Scoreboard</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> MY_SCOREBOARD__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> MY_SCOREBOARD__SV</span><br><span class="hljs-keyword">class</span> my_scoreboard <span class="hljs-keyword">extends</span> uvm_scoreboard;<br>   my_transaction  expect_queue[$];<br>   uvm_blocking_get_port <span class="hljs-variable">#(my_transaction)</span>  exp_port; <span class="hljs-comment">//声明一个端口，接收参考模型的输出</span><br>   uvm_blocking_get_port <span class="hljs-variable">#(my_transaction)</span>  act_port; <span class="hljs-comment">//声明一个端口，接收DUT输出monitor的输出</span><br>   `uvm_component_utils(my_scoreboard)<br><br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name, uvm_component parent = <span class="hljs-literal">null</span>);<br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase);<br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">task</span> main_phase(uvm_phase phase);<br><span class="hljs-keyword">endclass</span> <br><br><span class="hljs-keyword">function</span> my_scoreboard::<span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name, uvm_component parent = <span class="hljs-literal">null</span>);<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);<br><span class="hljs-keyword">endfunction</span> <br><br><span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> my_scoreboard::build_phase(uvm_phase phase);<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br>   exp_port = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;exp_port&quot;</span>, <span class="hljs-keyword">this</span>); <span class="hljs-comment">//实例化一个端口</span><br>   act_port = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;act_port&quot;</span>, <span class="hljs-keyword">this</span>); <span class="hljs-comment">//实例化一个端口</span><br><span class="hljs-keyword">endfunction</span> <br><br><span class="hljs-keyword">task</span> my_scoreboard::main_phase(uvm_phase phase);<br>   my_transaction  get_expect,  get_actual, tmp_tran; <span class="hljs-comment">//声明事务</span><br>   <span class="hljs-keyword">bit</span> result;<br> <br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.main_phase</span>(phase);<br>   <span class="hljs-keyword">fork</span>  <span class="hljs-comment">//fork块中并行执行，被begin，end包起来的顺序执行</span><br>      <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) <span class="hljs-keyword">begin</span> <span class="hljs-comment">//进程一，接收来自参考模型的事务</span><br>         exp_port<span class="hljs-variable">.get</span>(get_expect); <span class="hljs-comment">//通过exp_port获取预期事务</span><br>         expect_queue<span class="hljs-variable">.push_back</span>(get_expect); <span class="hljs-comment">//当收到数据后，把数据放入expect_queue中</span><br>      <span class="hljs-keyword">end</span><br>       <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) <span class="hljs-keyword">begin</span> <span class="hljs-comment">//进程二，接收来自DUT端的monitor事务</span><br>          act_port<span class="hljs-variable">.get</span>(get_actual); <span class="hljs-comment">//通过act_port获取</span><br>         <span class="hljs-keyword">if</span>(expect_queue<span class="hljs-variable">.size</span>() &gt; <span class="hljs-number">0</span>) <span class="hljs-keyword">begin</span><br>            tmp_tran = expect_queue<span class="hljs-variable">.pop_front</span>(); <span class="hljs-comment">//从expect_queue中弹出之前从exp_port收到的数据</span><br>            result = get_actual<span class="hljs-variable">.my_compare</span>(tmp_tran); <span class="hljs-comment">//比较，该my_compare在my_transaction中定义</span><br>            <span class="hljs-keyword">if</span>(result) <span class="hljs-keyword">begin</span> <br>               `uvm_info(<span class="hljs-string">&quot;my_scoreboard&quot;</span>, <span class="hljs-string">&quot;Compare SUCCESSFULLY&quot;</span>, UVM_LOW);<br>            <span class="hljs-keyword">end</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span><br>               `uvm_error(<span class="hljs-string">&quot;my_scoreboard&quot;</span>, <span class="hljs-string">&quot;Compare FAILED&quot;</span>);<br>               <span class="hljs-built_in">$display</span>(<span class="hljs-string">&quot;the expect pkt is&quot;</span>);<br>               tmp_tran<span class="hljs-variable">.my_print</span>();<br>               <span class="hljs-built_in">$display</span>(<span class="hljs-string">&quot;the actual pkt is&quot;</span>);<br>               get_actual<span class="hljs-variable">.my_print</span>();<br>            <span class="hljs-keyword">end</span><br>         <span class="hljs-keyword">end</span><br>         <span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span><br>            `uvm_error(<span class="hljs-string">&quot;my_scoreboard&quot;</span>, <span class="hljs-string">&quot;Received from DUT, while Expect Queue is empty&quot;</span>);<br>            <span class="hljs-built_in">$display</span>(<span class="hljs-string">&quot;the unexpected pkt is&quot;</span>);<br>            get_actual<span class="hljs-variable">.my_print</span>();<br>         <span class="hljs-keyword">end</span> <br>      <span class="hljs-keyword">end</span><br>   <span class="hljs-keyword">join</span><br><span class="hljs-keyword">endtask</span><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>

<p>采用这种比较处理方式的前提是exp_port要比act_port先收到数 据。由于DUT处理数据需要延时，而reference model是基于高级语言的处理，一般不需要延时，因此可以保证exp_port的数据在 act_port的数据之前到来。</p>
<p>端口连接，一共三个fifo，分别是，i-agent –&gt; refrence model，refrence model –&gt; scoreboard，o-agent –&gt; scoreboard</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">class</span> my_env <span class="hljs-keyword">extends</span> uvm_env;<br><br>   my_agent   i_agt;<br>   my_agent   o_agt;<br>   my_model   mdl;<br>   my_scoreboard scb;<br>   <br>   uvm_tlm_analysis_fifo <span class="hljs-variable">#(my_transaction)</span> agt_scb_fifo; <span class="hljs-comment">//o-agent --&gt; scoreboard</span><br>   uvm_tlm_analysis_fifo <span class="hljs-variable">#(my_transaction)</span> agt_mdl_fifo; <span class="hljs-comment">//i-agent --&gt; refrence model</span><br>   uvm_tlm_analysis_fifo <span class="hljs-variable">#(my_transaction)</span> mdl_scb_fifo; <span class="hljs-comment">//refrence model --&gt; scoreboard</span><br>   <br>   <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name = <span class="hljs-string">&quot;my_env&quot;</span>, uvm_component parent);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);<br>   <span class="hljs-keyword">endfunction</span><br><br>   <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br>      i_agt = my_agent::type_id::create(<span class="hljs-string">&quot;i_agt&quot;</span>, <span class="hljs-keyword">this</span>);<br>      o_agt = my_agent::type_id::create(<span class="hljs-string">&quot;o_agt&quot;</span>, <span class="hljs-keyword">this</span>);<br>      i_agt<span class="hljs-variable">.is_active</span> = UVM_ACTIVE;<br>      o_agt<span class="hljs-variable">.is_active</span> = UVM_PASSIVE;<br>      mdl = my_model::type_id::create(<span class="hljs-string">&quot;mdl&quot;</span>, <span class="hljs-keyword">this</span>);<br>      scb = my_scoreboard::type_id::create(<span class="hljs-string">&quot;scb&quot;</span>, <span class="hljs-keyword">this</span>);<br>      agt_scb_fifo = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;agt_scb_fifo&quot;</span>, <span class="hljs-keyword">this</span>); <span class="hljs-comment">//分别实例化fifo</span><br>      agt_mdl_fifo = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;agt_mdl_fifo&quot;</span>, <span class="hljs-keyword">this</span>);<br>      mdl_scb_fifo = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;mdl_scb_fifo&quot;</span>, <span class="hljs-keyword">this</span>);<br>   <span class="hljs-keyword">endfunction</span><br><br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> connect_phase(uvm_phase phase);<br>   <br>   `uvm_component_utils(my_env)<br><span class="hljs-keyword">endclass</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> my_env::connect_phase(uvm_phase phase);<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.connect_phase</span>(phase);<br>   <span class="hljs-comment">//i-agent --&gt; refrence model</span><br>   i_agt<span class="hljs-variable">.ap</span><span class="hljs-variable">.connect</span>(agt_mdl_fifo<span class="hljs-variable">.analysis_export</span>);<br>   mdl<span class="hljs-variable">.port</span><span class="hljs-variable">.connect</span>(agt_mdl_fifo<span class="hljs-variable">.blocking_get_export</span>);<br>   <span class="hljs-comment">//refrence model --&gt; scoreboard </span><br>   mdl<span class="hljs-variable">.ap</span><span class="hljs-variable">.connect</span>(mdl_scb_fifo<span class="hljs-variable">.analysis_export</span>);<br>   scb<span class="hljs-variable">.exp_port</span><span class="hljs-variable">.connect</span>(mdl_scb_fifo<span class="hljs-variable">.blocking_get_export</span>);<br>   <span class="hljs-comment">//o-agent --&gt; scoreboard</span><br>   o_agt<span class="hljs-variable">.ap</span><span class="hljs-variable">.connect</span>(agt_scb_fifo<span class="hljs-variable">.analysis_export</span>);<br>   scb<span class="hljs-variable">.act_port</span><span class="hljs-variable">.connect</span>(agt_scb_fifo<span class="hljs-variable">.blocking_get_export</span>); <br><span class="hljs-keyword">endfunction</span><br></code></pre></td></tr></table></figure>

<h3 id="TLM通信"><a href="#TLM通信" class="headerlink" title="TLM通信"></a>TLM通信</h3><p>TLM：Transaction Level Modeling事务级建模</p>
<p>各个模块之间通信的是事务transaction，比如各类port 之间的信息传输</p>
<p>TLM术语： 端口类型：port、export、imp； 操作类型：put、get、transport</p>
<p>端口有阻塞和非阻塞的区分</p>
<p>port与export相连并不能 完成通信，export端再连一个imp</p>
<p>FIFO实质上是双端的imp，但其隐藏了imp，简单容易理解</p>
<p>详细解释查阅书籍</p>
<h4 id="field-automation机制"><a href="#field-automation机制" class="headerlink" title="field_automation机制"></a>field_automation机制</h4><p>暂时省略，具体代码见文末代码汇总</p>
<h2 id="sequencer-amp-sequence"><a href="#sequencer-amp-sequence" class="headerlink" title="sequencer &amp; sequence"></a>sequencer &amp; sequence</h2><p>agent三元组：sequencer、 driver和monitor</p>
<p>sequence：激励序列，产生transaction，transaction组成激励序列</p>
<p>sequencer：字面是序列器；负责发送激励序列</p>
<p>driver驱动激励，与 sequencer紧密合作</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> MY_SEQUENCER__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> MY_SEQUENCER__SV</span><br><br><span class="hljs-keyword">class</span> my_sequencer <span class="hljs-keyword">extends</span> uvm_sequencer <span class="hljs-variable">#(my_transaction)</span>;<br>   <br>   <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name, uvm_component parent);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);<br>   <span class="hljs-keyword">endfunction</span> <br>   <br>   `uvm_component_utils(my_sequencer)<br><span class="hljs-keyword">endclass</span><br><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br><br></code></pre></td></tr></table></figure>



<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> MY_SEQUENCE__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> MY_SEQUENCE__SV</span><br><br><span class="hljs-keyword">class</span> my_sequence <span class="hljs-keyword">extends</span> uvm_sequence <span class="hljs-variable">#(my_transaction)</span>;<br>   my_transaction m_trans;<br><br>   <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name= <span class="hljs-string">&quot;my_sequence&quot;</span>);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name);<br>   <span class="hljs-keyword">endfunction</span><br>   <span class="hljs-comment">//每一个sequence都有一个body任务；当一个sequence启动之后，会自动执行body中的代码</span><br>   <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">task</span> body();<br>      <span class="hljs-comment">//在uvm_sequence这个基类中，有一个变量名为starting_phase，它的类型是uvm_phase，</span><br>      <span class="hljs-comment">//sequencer在启动default_sequence时，会执行</span><br>      <span class="hljs-comment">//seq.starting_phase = phase;</span><br>      <span class="hljs-comment">//seq.start(this); </span><br>      <span class="hljs-comment">//因此，可以在sequence中使用starting_phase进行提起和撤销objection</span><br>      <span class="hljs-comment">//在其他任何地方都不必再设置objection</span><br>      <span class="hljs-keyword">if</span>(starting_phase != <span class="hljs-literal">null</span>) <br>         starting_phase<span class="hljs-variable">.raise_objection</span>(<span class="hljs-keyword">this</span>);<br>      <span class="hljs-keyword">repeat</span> (<span class="hljs-number">10</span>) <span class="hljs-keyword">begin</span><br>         `uvm_do(m_trans) <span class="hljs-comment">//宏uvm_do，创建一个my_transaction的实例m_trans，随机化，将其送给sequencer</span><br>      <span class="hljs-keyword">end</span><br>      #<span class="hljs-number">1000</span>;<br>      <span class="hljs-keyword">if</span>(starting_phase != <span class="hljs-literal">null</span>) <br>         starting_phase<span class="hljs-variable">.drop_objection</span>(<span class="hljs-keyword">this</span>);<br>   <span class="hljs-keyword">endtask</span><br><br>   `uvm_object_utils(my_sequence)<br><span class="hljs-keyword">endclass</span><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>



<p>sequencer仲裁driver和sequence双方的请求，1）检测是否有 sequence发送transaction的请求；2）检测是否driver申请transaction。</p>
<p>sequencer操作： 有发送，有申请，则立刻发送；有发送，无申请，等driver申请；有申请，无发送，等sequence发送。</p>
<p>在agent中实例化sequencer</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">class</span> my_agent <span class="hljs-keyword">extends</span> uvm_agent ;<br>   my_sequencer  sqr; <span class="hljs-comment">//声明</span><br>   my_driver     drv;<br>   my_monitor    mon;<br>   <br>   uvm_analysis_port <span class="hljs-variable">#(my_transaction)</span>  ap;<br>   <br>   <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name, uvm_component parent);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);<br>   <span class="hljs-keyword">endfunction</span> <br>   <br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase);<br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> connect_phase(uvm_phase phase);<br><br>   `uvm_component_utils(my_agent)<br><span class="hljs-keyword">endclass</span> <br><br><br><span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> my_agent::build_phase(uvm_phase phase);<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br>   <span class="hljs-keyword">if</span> (is_active == UVM_ACTIVE) <span class="hljs-keyword">begin</span><br>      sqr = my_sequencer::type_id::create(<span class="hljs-string">&quot;sqr&quot;</span>, <span class="hljs-keyword">this</span>); <span class="hljs-comment">//实例化</span><br>      drv = my_driver::type_id::create(<span class="hljs-string">&quot;drv&quot;</span>, <span class="hljs-keyword">this</span>);<br>   <span class="hljs-keyword">end</span><br>   mon = my_monitor::type_id::create(<span class="hljs-string">&quot;mon&quot;</span>, <span class="hljs-keyword">this</span>);<br><span class="hljs-keyword">endfunction</span> <br><br><span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> my_agent::connect_phase(uvm_phase phase);<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.connect_phase</span>(phase);<br>   <span class="hljs-keyword">if</span> (is_active == UVM_ACTIVE) <span class="hljs-keyword">begin</span><br>      <span class="hljs-comment">//seq_item_port是uvm_driver中的成员变量，seq_item_export是uvm_sequencer中的成员变量</span><br>      <span class="hljs-comment">//连接driver与sequencer</span><br>      drv<span class="hljs-variable">.seq_item_port</span><span class="hljs-variable">.connect</span>(sqr<span class="hljs-variable">.seq_item_export</span>);<br>   <span class="hljs-keyword">end</span><br>   ap = mon<span class="hljs-variable">.ap</span>;<br><span class="hljs-keyword">endfunction</span><br></code></pre></td></tr></table></figure>

<p>在driver中使用port申请获取transaction</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">task</span> my_driver::main_phase(uvm_phase phase);<br>   vif<span class="hljs-variable">.data</span> &lt;= <span class="hljs-number">8&#x27;b0</span>;<br>   vif<span class="hljs-variable">.valid</span> &lt;= <span class="hljs-number">1&#x27;b0</span>;<br>   <span class="hljs-keyword">while</span>(!vif<span class="hljs-variable">.rst_n</span>)<br>      @(<span class="hljs-keyword">posedge</span> vif<span class="hljs-variable">.clk</span>);<br>   <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">begin</span><br>      seq_item_port<span class="hljs-variable">.get_next_item</span>(req); <span class="hljs-comment">//通过get_next_item任务来得到一个新的req，并且驱动它</span><br>      drive_one_pkt(req); <span class="hljs-comment">//驱动req</span><br>      seq_item_port<span class="hljs-variable">.item_done</span>(); <span class="hljs-comment">//驱动完成后调用item_done通知sequencer</span><br>      <span class="hljs-comment">//sequencer留存req，当发出了但driver没有收到时，使用备份发送</span><br>      <span class="hljs-comment">//item_done被调用后，sequencer删除备份</span><br>   <span class="hljs-keyword">end</span><br><span class="hljs-keyword">endtask</span><br></code></pre></td></tr></table></figure>

<p>sequence向sequencer发送transaction</p>
<p>可以手动开启</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">task</span> my_env::main_phase(uvm_phase phase);<br>   my_sequence seq;<br>   phase<span class="hljs-variable">.raise_objection</span>(<span class="hljs-keyword">this</span>);<br>   seq = my_sequence::type_id::create(<span class="hljs-string">&quot;seq&quot;</span>);<br>   seq<span class="hljs-variable">.start</span>(i_agt<span class="hljs-variable">.sqr</span>); <br>   phase<span class="hljs-variable">.drop_objection</span>(<span class="hljs-keyword">this</span>);<br><span class="hljs-keyword">endtask</span><br><br></code></pre></td></tr></table></figure>

<h3 id="default-sequence的使用"><a href="#default-sequence的使用" class="headerlink" title="default_sequence的使用"></a>default_sequence的使用</h3><p>使用default_sequence的方式非常简单，只需要在某个component（如my_env）的build_phase中设置如下代码即可</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs verilog"> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase);<br>    <span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br>    i_agt = my_agent::type_id::create(<span class="hljs-string">&quot;i_agt&quot;</span>, <span class="hljs-keyword">this</span>);<br>    o_agt = my_agent::type_id::create(<span class="hljs-string">&quot;o_agt&quot;</span>, <span class="hljs-keyword">this</span>);<br>    i_agt<span class="hljs-variable">.is_active</span> = UVM_ACTIVE;<br>    o_agt<span class="hljs-variable">.is_active</span> = UVM_PASSIVE;<br>    mdl = my_model::type_id::create(<span class="hljs-string">&quot;mdl&quot;</span>, <span class="hljs-keyword">this</span>);<br>    scb = my_scoreboard::type_id::create(<span class="hljs-string">&quot;scb&quot;</span>, <span class="hljs-keyword">this</span>);<br>    agt_scb_fifo = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;agt_scb_fifo&quot;</span>, <span class="hljs-keyword">this</span>);<br>    agt_mdl_fifo = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;agt_mdl_fifo&quot;</span>, <span class="hljs-keyword">this</span>);<br>    mdl_scb_fifo = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;mdl_scb_fifo&quot;</span>, <span class="hljs-keyword">this</span>);<br>    uvm_config_db<span class="hljs-variable">#(uvm_object_wrapper)</span>::set(<span class="hljs-keyword">this</span>,<br>                                            <span class="hljs-string">&quot;i_agt.sqr.main_phase&quot;</span>,<br>                                            <span class="hljs-string">&quot;default_sequence&quot;</span>,<br>                                             my_sequence::type_id::get());<br>     <br><span class="hljs-comment">//第二个参数是相对于第一个参数的相对路劲，目前树根，仍然是env，因此，第一个参数可以写this</span><br>   <span class="hljs-comment">//UVM在设置default_sequence时的要求，必须指定是哪个phase</span><br>   <span class="hljs-comment">//也可以在agent，或者top_tb中设置default_sequence</span><br> <span class="hljs-keyword">endfunction</span><br></code></pre></td></tr></table></figure>

<h2 id="base-test"><a href="#base-test" class="headerlink" title="base_test"></a>base_test</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> BASE_TEST__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> BASE_TEST__SV</span><br><br><span class="hljs-keyword">class</span> base_test <span class="hljs-keyword">extends</span> uvm_test;<br><br>   my_env         env;<br>   <br>   <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name = <span class="hljs-string">&quot;base_test&quot;</span>, uvm_component parent = <span class="hljs-literal">null</span>);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name,parent);<br>   <span class="hljs-keyword">endfunction</span><br>   <br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase);<br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> report_phase(uvm_phase phase);<br>   <span class="hljs-comment">//report_phase运行在run phase之后；输出test case是否成功</span><br>   `uvm_component_utils(base_test)<br><span class="hljs-keyword">endclass</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> base_test::build_phase(uvm_phase phase);<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br>   env  =  my_env::type_id::create(<span class="hljs-string">&quot;env&quot;</span>, <span class="hljs-keyword">this</span>); <br>   uvm_config_db<span class="hljs-variable">#(uvm_object_wrapper)</span>::set(<span class="hljs-keyword">this</span>,<br>                                           <span class="hljs-string">&quot;env.i_agt.sqr.main_phase&quot;</span>,<br>                                           <span class="hljs-string">&quot;default_sequence&quot;</span>,<br>                                            my_sequence::type_id::get());<br><span class="hljs-keyword">endfunction</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> base_test::report_phase(uvm_phase phase);<br>   uvm_report_server server;<br>   <span class="hljs-keyword">int</span> err_num;<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.report_phase</span>(phase);<br>   server = get_report_server();<br>   err_num = server<span class="hljs-variable">.get_severity_count</span>(UVM_ERROR); <span class="hljs-comment">//获取ERROR个数，并输出pass/fail</span><br>   <span class="hljs-keyword">if</span> (err_num != <span class="hljs-number">0</span>) <span class="hljs-keyword">begin</span><br>      <span class="hljs-built_in">$display</span>(<span class="hljs-string">&quot;TEST CASE FAILED&quot;</span>);<br>   <span class="hljs-keyword">end</span><br>   <span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span><br>      <span class="hljs-built_in">$display</span>(<span class="hljs-string">&quot;TEST CASE PASSED&quot;</span>);<br>   <span class="hljs-keyword">end</span><br><span class="hljs-keyword">endfunction</span><br><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br><br></code></pre></td></tr></table></figure>

<p>top_tb中run_test的参数从my_env变成了base_test，并且config_db中设置virtual interface的路径参数要改变</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span><br>   run_test(<span class="hljs-string">&quot;base_test&quot;</span>);<br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span><br>   uvm_config_db<span class="hljs-variable">#(virtual my_if)::set(null, &quot;uvm_test_top.env.i_agt.drv&quot;, &quot;vif&quot;, input_if)</span>;<br>   uvm_config_db<span class="hljs-variable">#(virtual my_if)::set(null, &quot;uvm_test_top.env.i_agt.mon&quot;, &quot;vif&quot;, input_if)</span>;<br>   uvm_config_db<span class="hljs-variable">#(virtual my_if)::set(null, &quot;uvm_test_top.env.o_agt.mon&quot;, &quot;vif&quot;, output_if)</span>;<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<h2 id="多用例构造时的代码复用"><a href="#多用例构造时的代码复用" class="headerlink" title="多用例构造时的代码复用"></a>多用例构造时的代码复用</h2><p>测试激励：test vector或pattern；测试用例的核心部分。 （如本例中sequence uvm_do产生的transaction数据包）</p>
<p>不同的测试激励对应于不同的测试用例；即，不同的 sequence对应不同的test case，但用例其他部分是相同的，如 driver、monitor等。</p>
<p>为验证完备，需要大量的test case，其实是需要大量的 sequence，其他部分均可以复用。</p>
<p>最终完整的验证平台：</p>
<h4 id="top-tb-sv"><a href="#top-tb-sv" class="headerlink" title="top_tb.sv"></a>top_tb.sv</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">timescale</span> 1ns/1ps</span><br><span class="hljs-meta">`<span class="hljs-keyword">include</span> &quot;uvm_macros.svh&quot;</span><br><br><span class="hljs-keyword">import</span> uvm_pkg::*;<br><span class="hljs-meta">`<span class="hljs-keyword">include</span> &quot;my_if.sv&quot;</span><br><span class="hljs-meta">`<span class="hljs-keyword">include</span> &quot;my_transaction.sv&quot;</span><br><span class="hljs-meta">`<span class="hljs-keyword">include</span> &quot;my_sequencer.sv&quot;</span><br><span class="hljs-meta">`<span class="hljs-keyword">include</span> &quot;my_driver.sv&quot;</span><br><span class="hljs-meta">`<span class="hljs-keyword">include</span> &quot;my_monitor.sv&quot;</span><br><span class="hljs-meta">`<span class="hljs-keyword">include</span> &quot;my_agent.sv&quot;</span><br><span class="hljs-meta">`<span class="hljs-keyword">include</span> &quot;my_model.sv&quot;</span><br><span class="hljs-meta">`<span class="hljs-keyword">include</span> &quot;my_scoreboard.sv&quot;</span><br><span class="hljs-meta">`<span class="hljs-keyword">include</span> &quot;my_env.sv&quot;</span><br><span class="hljs-meta">`<span class="hljs-keyword">include</span> &quot;base_test.sv&quot;</span><br><span class="hljs-meta">`<span class="hljs-keyword">include</span> &quot;my_case0.sv&quot;</span><br><span class="hljs-meta">`<span class="hljs-keyword">include</span> &quot;my_case1.sv&quot;</span><br><br><span class="hljs-keyword">module</span> top_tb;<br><br><span class="hljs-keyword">reg</span> clk;<br><span class="hljs-keyword">reg</span> rst_n;<br><span class="hljs-keyword">reg</span>[<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] rxd;<br><span class="hljs-keyword">reg</span> rx_dv;<br><span class="hljs-keyword">wire</span>[<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] txd;<br><span class="hljs-keyword">wire</span> tx_en;<br><br>my_if input_if(clk, rst_n);<br>my_if output_if(clk, rst_n);<br><br>dut my_dut(<span class="hljs-variable">.clk</span>(clk),<br>           <span class="hljs-variable">.rst_n</span>(rst_n),<br>           <span class="hljs-variable">.rxd</span>(input_if<span class="hljs-variable">.data</span>),<br>           <span class="hljs-variable">.rx_dv</span>(input_if<span class="hljs-variable">.valid</span>),<br>           <span class="hljs-variable">.txd</span>(output_if<span class="hljs-variable">.data</span>),<br>           <span class="hljs-variable">.tx_en</span>(output_if<span class="hljs-variable">.valid</span>));<br><br><span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span><br>   clk = <span class="hljs-number">0</span>;<br>   <span class="hljs-keyword">forever</span> <span class="hljs-keyword">begin</span><br>      #<span class="hljs-number">100</span> clk = ~clk;<br>   <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span><br>   rst_n = <span class="hljs-number">1&#x27;b0</span>;<br>   #<span class="hljs-number">1000</span>;<br>   rst_n = <span class="hljs-number">1&#x27;b1</span>;<br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span><br>   run_test();<br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span><br>   uvm_config_db<span class="hljs-variable">#(virtual my_if)::set(null, &quot;uvm_test_top.env.i_agt.drv&quot;, &quot;vif&quot;, input_if)</span>;<br>   uvm_config_db<span class="hljs-variable">#(virtual my_if)::set(null, &quot;uvm_test_top.env.i_agt.mon&quot;, &quot;vif&quot;, input_if)</span>;<br>   uvm_config_db<span class="hljs-variable">#(virtual my_if)::set(null, &quot;uvm_test_top.env.o_agt.mon&quot;, &quot;vif&quot;, output_if)</span>;<br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">endmodule</span><br><br></code></pre></td></tr></table></figure>



<h4 id="my-case0-sv"><a href="#my-case0-sv" class="headerlink" title="my_case0.sv"></a>my_case0.sv</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> MY_CASE0__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> MY_CASE0__SV</span><br><span class="hljs-keyword">class</span> case0_sequence <span class="hljs-keyword">extends</span> uvm_sequence <span class="hljs-variable">#(my_transaction)</span>;<br>   my_transaction m_trans;<br><br>   <span class="hljs-keyword">function</span>  <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name= <span class="hljs-string">&quot;case0_sequence&quot;</span>);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name);<br>   <span class="hljs-keyword">endfunction</span> <br>   <br>   <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">task</span> body();<br>      <span class="hljs-keyword">if</span>(starting_phase != <span class="hljs-literal">null</span>) <br>         starting_phase<span class="hljs-variable">.raise_objection</span>(<span class="hljs-keyword">this</span>);<br>      <span class="hljs-keyword">repeat</span> (<span class="hljs-number">10</span>) <span class="hljs-keyword">begin</span><br>         `uvm_do(m_trans)<br>      <span class="hljs-keyword">end</span><br>      #<span class="hljs-number">100</span>;<br>      <span class="hljs-keyword">if</span>(starting_phase != <span class="hljs-literal">null</span>) <br>         starting_phase<span class="hljs-variable">.drop_objection</span>(<span class="hljs-keyword">this</span>);<br>   <span class="hljs-keyword">endtask</span><br><br>   `uvm_object_utils(case0_sequence)<br><span class="hljs-keyword">endclass</span><br><br><br><span class="hljs-keyword">class</span> my_case0 <span class="hljs-keyword">extends</span> base_test;<br><br>   <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name = <span class="hljs-string">&quot;my_case0&quot;</span>, uvm_component parent = <span class="hljs-literal">null</span>);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name,parent);<br>   <span class="hljs-keyword">endfunction</span> <br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase); <br>   `uvm_component_utils(my_case0)<br><span class="hljs-keyword">endclass</span><br><br><br><span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> my_case0::build_phase(uvm_phase phase);<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br><br>   uvm_config_db<span class="hljs-variable">#(uvm_object_wrapper)</span>::set(<span class="hljs-keyword">this</span>, <br>                                           <span class="hljs-string">&quot;env.i_agt.sqr.main_phase&quot;</span>, <br>                                           <span class="hljs-string">&quot;default_sequence&quot;</span>, <br>                                           case0_sequence::type_id::get());<br><span class="hljs-keyword">endfunction</span><br><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>

<h4 id="my-case1-sv"><a href="#my-case1-sv" class="headerlink" title="my_case1.sv"></a>my_case1.sv</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> MY_CASE1__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> MY_CASE1__SV</span><br><span class="hljs-keyword">class</span> case1_sequence <span class="hljs-keyword">extends</span> uvm_sequence <span class="hljs-variable">#(my_transaction)</span>;<br>   my_transaction m_trans;<br><br>   <span class="hljs-keyword">function</span>  <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name= <span class="hljs-string">&quot;case1_sequence&quot;</span>);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name);<br>   <span class="hljs-keyword">endfunction</span> <br><br>   <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">task</span> body();<br>      <span class="hljs-keyword">if</span>(starting_phase != <span class="hljs-literal">null</span>) <br>         starting_phase<span class="hljs-variable">.raise_objection</span>(<span class="hljs-keyword">this</span>);<br>      <span class="hljs-keyword">repeat</span> (<span class="hljs-number">10</span>) <span class="hljs-keyword">begin</span><br>         `uvm_do_with(m_trans, &#123; m_trans<span class="hljs-variable">.pload</span><span class="hljs-variable">.size</span>() == <span class="hljs-number">60</span>;&#125;)<br>      <span class="hljs-keyword">end</span><br>      #<span class="hljs-number">100</span>;<br>      <span class="hljs-keyword">if</span>(starting_phase != <span class="hljs-literal">null</span>) <br>         starting_phase<span class="hljs-variable">.drop_objection</span>(<span class="hljs-keyword">this</span>);<br>   <span class="hljs-keyword">endtask</span><br><br>   `uvm_object_utils(case1_sequence)<br><span class="hljs-keyword">endclass</span><br><br><span class="hljs-keyword">class</span> my_case1 <span class="hljs-keyword">extends</span> base_test;<br>  <br>   <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name = <span class="hljs-string">&quot;my_case1&quot;</span>, uvm_component parent = <span class="hljs-literal">null</span>);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name,parent);<br>   <span class="hljs-keyword">endfunction</span> <br>   <br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase); <br>   `uvm_component_utils(my_case1)<br><span class="hljs-keyword">endclass</span><br><br><br><span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> my_case1::build_phase(uvm_phase phase);<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br><br>   uvm_config_db<span class="hljs-variable">#(uvm_object_wrapper)</span>::set(<span class="hljs-keyword">this</span>, <br>                                           <span class="hljs-string">&quot;env.i_agt.sqr.main_phase&quot;</span>, <br>                                           <span class="hljs-string">&quot;default_sequence&quot;</span>, <br>                                           case1_sequence::type_id::get()); <span class="hljs-comment">//case1_sequence</span><br><span class="hljs-keyword">endfunction</span><br><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>

<h4 id="base-test-sv"><a href="#base-test-sv" class="headerlink" title="base_test.sv"></a>base_test.sv</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> BASE_TEST__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> BASE_TEST__SV</span><br><br><span class="hljs-keyword">class</span> base_test <span class="hljs-keyword">extends</span> uvm_test;<br><br>   my_env         env;<br>   <br>   <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name = <span class="hljs-string">&quot;base_test&quot;</span>, uvm_component parent = <span class="hljs-literal">null</span>);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name,parent);<br>   <span class="hljs-keyword">endfunction</span><br>   <br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase);<br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> report_phase(uvm_phase phase);<br>   `uvm_component_utils(base_test)<br><span class="hljs-keyword">endclass</span><br><br><br><span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> base_test::build_phase(uvm_phase phase);<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br>   env  =  my_env::type_id::create(<span class="hljs-string">&quot;env&quot;</span>, <span class="hljs-keyword">this</span>); <br><span class="hljs-keyword">endfunction</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> base_test::report_phase(uvm_phase phase);<br>   uvm_report_server server;<br>   <span class="hljs-keyword">int</span> err_num;<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.report_phase</span>(phase);<br><br>   server = get_report_server();<br>   err_num = server<span class="hljs-variable">.get_severity_count</span>(UVM_ERROR);<br><br>   <span class="hljs-keyword">if</span> (err_num != <span class="hljs-number">0</span>) <span class="hljs-keyword">begin</span><br>      <span class="hljs-built_in">$display</span>(<span class="hljs-string">&quot;TEST CASE FAILED&quot;</span>);<br>   <span class="hljs-keyword">end</span><br>   <span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span><br>      <span class="hljs-built_in">$display</span>(<span class="hljs-string">&quot;TEST CASE PASSED&quot;</span>);<br>   <span class="hljs-keyword">end</span><br><span class="hljs-keyword">endfunction</span><br><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>

<h4 id="my-env-sv"><a href="#my-env-sv" class="headerlink" title="my_env.sv"></a>my_env.sv</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> MY_ENV__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> MY_ENV__SV</span><br><br><span class="hljs-keyword">class</span> my_env <span class="hljs-keyword">extends</span> uvm_env;<br><br>   my_agent   i_agt;<br>   my_agent   o_agt;<br>   my_model   mdl;<br>   my_scoreboard scb;<br>   <br>   uvm_tlm_analysis_fifo <span class="hljs-variable">#(my_transaction)</span> agt_scb_fifo;<br>   uvm_tlm_analysis_fifo <span class="hljs-variable">#(my_transaction)</span> agt_mdl_fifo;<br>   uvm_tlm_analysis_fifo <span class="hljs-variable">#(my_transaction)</span> mdl_scb_fifo;<br>   <br>   <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name = <span class="hljs-string">&quot;my_env&quot;</span>, uvm_component parent);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);<br>   <span class="hljs-keyword">endfunction</span><br><br>   <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br>      i_agt = my_agent::type_id::create(<span class="hljs-string">&quot;i_agt&quot;</span>, <span class="hljs-keyword">this</span>);<br>      o_agt = my_agent::type_id::create(<span class="hljs-string">&quot;o_agt&quot;</span>, <span class="hljs-keyword">this</span>);<br>      i_agt<span class="hljs-variable">.is_active</span> = UVM_ACTIVE;<br>      o_agt<span class="hljs-variable">.is_active</span> = UVM_PASSIVE;<br>      mdl = my_model::type_id::create(<span class="hljs-string">&quot;mdl&quot;</span>, <span class="hljs-keyword">this</span>);<br>      scb = my_scoreboard::type_id::create(<span class="hljs-string">&quot;scb&quot;</span>, <span class="hljs-keyword">this</span>);<br>      agt_scb_fifo = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;agt_scb_fifo&quot;</span>, <span class="hljs-keyword">this</span>);<br>      agt_mdl_fifo = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;agt_mdl_fifo&quot;</span>, <span class="hljs-keyword">this</span>);<br>      mdl_scb_fifo = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;mdl_scb_fifo&quot;</span>, <span class="hljs-keyword">this</span>);<br><br>   <span class="hljs-keyword">endfunction</span><br><br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> connect_phase(uvm_phase phase);<br>   <br>   `uvm_component_utils(my_env)<br><span class="hljs-keyword">endclass</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> my_env::connect_phase(uvm_phase phase);<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.connect_phase</span>(phase);<br>   i_agt<span class="hljs-variable">.ap</span><span class="hljs-variable">.connect</span>(agt_mdl_fifo<span class="hljs-variable">.analysis_export</span>);<br>   mdl<span class="hljs-variable">.port</span><span class="hljs-variable">.connect</span>(agt_mdl_fifo<span class="hljs-variable">.blocking_get_export</span>);<br>   mdl<span class="hljs-variable">.ap</span><span class="hljs-variable">.connect</span>(mdl_scb_fifo<span class="hljs-variable">.analysis_export</span>);<br>   scb<span class="hljs-variable">.exp_port</span><span class="hljs-variable">.connect</span>(mdl_scb_fifo<span class="hljs-variable">.blocking_get_export</span>);<br>   o_agt<span class="hljs-variable">.ap</span><span class="hljs-variable">.connect</span>(agt_scb_fifo<span class="hljs-variable">.analysis_export</span>);<br>   scb<span class="hljs-variable">.act_port</span><span class="hljs-variable">.connect</span>(agt_scb_fifo<span class="hljs-variable">.blocking_get_export</span>); <br><span class="hljs-keyword">endfunction</span><br><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br><br></code></pre></td></tr></table></figure>

<h4 id="my-scoreboard"><a href="#my-scoreboard" class="headerlink" title="my_scoreboard"></a>my_scoreboard</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> MY_SCOREBOARD__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> MY_SCOREBOARD__SV</span><br><span class="hljs-keyword">class</span> my_scoreboard <span class="hljs-keyword">extends</span> uvm_scoreboard;<br>   my_transaction  expect_queue[$];<br>   uvm_blocking_get_port <span class="hljs-variable">#(my_transaction)</span>  exp_port;<br>   uvm_blocking_get_port <span class="hljs-variable">#(my_transaction)</span>  act_port;<br>   `uvm_component_utils(my_scoreboard)<br><br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name, uvm_component parent = <span class="hljs-literal">null</span>);<br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase);<br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">task</span> main_phase(uvm_phase phase);<br><span class="hljs-keyword">endclass</span> <br><br><span class="hljs-keyword">function</span> my_scoreboard::<span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name, uvm_component parent = <span class="hljs-literal">null</span>);<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);<br><span class="hljs-keyword">endfunction</span> <br><br><span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> my_scoreboard::build_phase(uvm_phase phase);<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br>   exp_port = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;exp_port&quot;</span>, <span class="hljs-keyword">this</span>);<br>   act_port = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;act_port&quot;</span>, <span class="hljs-keyword">this</span>);<br><span class="hljs-keyword">endfunction</span> <br><br><span class="hljs-keyword">task</span> my_scoreboard::main_phase(uvm_phase phase);<br>   my_transaction  get_expect,  get_actual, tmp_tran;<br>   <span class="hljs-keyword">bit</span> result;<br> <br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.main_phase</span>(phase);<br>   <span class="hljs-keyword">fork</span> <br>      <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) <span class="hljs-keyword">begin</span><br>         exp_port<span class="hljs-variable">.get</span>(get_expect);<br>         expect_queue<span class="hljs-variable">.push_back</span>(get_expect);<br>      <span class="hljs-keyword">end</span><br>      <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) <span class="hljs-keyword">begin</span><br>         act_port<span class="hljs-variable">.get</span>(get_actual);<br>         <span class="hljs-keyword">if</span>(expect_queue<span class="hljs-variable">.size</span>() &gt; <span class="hljs-number">0</span>) <span class="hljs-keyword">begin</span><br>            tmp_tran = expect_queue<span class="hljs-variable">.pop_front</span>();<br>            result = get_actual<span class="hljs-variable">.compare</span>(tmp_tran);<br>            <span class="hljs-keyword">if</span>(result) <span class="hljs-keyword">begin</span> <br>               `uvm_info(<span class="hljs-string">&quot;my_scoreboard&quot;</span>, <span class="hljs-string">&quot;Compare SUCCESSFULLY&quot;</span>, UVM_LOW);<br>            <span class="hljs-keyword">end</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span><br>               `uvm_error(<span class="hljs-string">&quot;my_scoreboard&quot;</span>, <span class="hljs-string">&quot;Compare FAILED&quot;</span>);<br>               <span class="hljs-built_in">$display</span>(<span class="hljs-string">&quot;the expect pkt is&quot;</span>);<br>               tmp_tran<span class="hljs-variable">.print</span>();<br>               <span class="hljs-built_in">$display</span>(<span class="hljs-string">&quot;the actual pkt is&quot;</span>);<br>               get_actual<span class="hljs-variable">.print</span>();<br>            <span class="hljs-keyword">end</span><br>         <span class="hljs-keyword">end</span><br>         <span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span><br>            `uvm_error(<span class="hljs-string">&quot;my_scoreboard&quot;</span>, <span class="hljs-string">&quot;Received from DUT, while Expect Queue is empty&quot;</span>);<br>            <span class="hljs-built_in">$display</span>(<span class="hljs-string">&quot;the unexpected pkt is&quot;</span>);<br>            get_actual<span class="hljs-variable">.print</span>();<br>         <span class="hljs-keyword">end</span> <br>      <span class="hljs-keyword">end</span><br>   <span class="hljs-keyword">join</span><br><span class="hljs-keyword">endtask</span><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br><br></code></pre></td></tr></table></figure>

<h4 id="my-model-sv"><a href="#my-model-sv" class="headerlink" title="my_model.sv"></a>my_model.sv</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> MY_MODEL__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> MY_MODEL__SV</span><br><br><span class="hljs-keyword">class</span> my_model <span class="hljs-keyword">extends</span> uvm_component;<br>   <br>   uvm_blocking_get_port <span class="hljs-variable">#(my_transaction)</span>  port;<br>   uvm_analysis_port <span class="hljs-variable">#(my_transaction)</span>  ap;<br><br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name, uvm_component parent);<br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase);<br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span>  <span class="hljs-keyword">task</span> main_phase(uvm_phase phase);<br><br>   `uvm_component_utils(my_model)<br><span class="hljs-keyword">endclass</span> <br><br><span class="hljs-keyword">function</span> my_model::<span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name, uvm_component parent);<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);<br><span class="hljs-keyword">endfunction</span> <br><br><span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> my_model::build_phase(uvm_phase phase);<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br>   port = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;port&quot;</span>, <span class="hljs-keyword">this</span>);<br>   ap = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;ap&quot;</span>, <span class="hljs-keyword">this</span>);<br><span class="hljs-keyword">endfunction</span><br><br><span class="hljs-keyword">task</span> my_model::main_phase(uvm_phase phase);<br>   my_transaction tr;<br>   my_transaction new_tr;<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.main_phase</span>(phase);<br>   <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">begin</span><br>      port<span class="hljs-variable">.get</span>(tr);<br>      new_tr = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;new_tr&quot;</span>);<br>      new_tr<span class="hljs-variable">.copy</span>(tr);<br>      `uvm_info(<span class="hljs-string">&quot;my_model&quot;</span>, <span class="hljs-string">&quot;get one transaction, copy and print it:&quot;</span>, UVM_LOW)<br>      new_tr<span class="hljs-variable">.print</span>();<br>      ap<span class="hljs-variable">.write</span>(new_tr);<br>   <span class="hljs-keyword">end</span><br><span class="hljs-keyword">endtask</span><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br><br></code></pre></td></tr></table></figure>

<h4 id="my-agent"><a href="#my-agent" class="headerlink" title="my_agent"></a>my_agent</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> MY_AGENT__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> MY_AGENT__SV</span><br><br><span class="hljs-keyword">class</span> my_agent <span class="hljs-keyword">extends</span> uvm_agent ;<br>   my_sequencer  sqr;<br>   my_driver     drv;<br>   my_monitor    mon;<br>   <br>   uvm_analysis_port <span class="hljs-variable">#(my_transaction)</span>  ap;<br>   <br>   <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name, uvm_component parent);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);<br>   <span class="hljs-keyword">endfunction</span> <br>   <br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase);<br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> connect_phase(uvm_phase phase);<br><br>   `uvm_component_utils(my_agent)<br><span class="hljs-keyword">endclass</span> <br><br><span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> my_agent::build_phase(uvm_phase phase);<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br>   <span class="hljs-keyword">if</span> (is_active == UVM_ACTIVE) <span class="hljs-keyword">begin</span><br>      sqr = my_sequencer::type_id::create(<span class="hljs-string">&quot;sqr&quot;</span>, <span class="hljs-keyword">this</span>);<br>      drv = my_driver::type_id::create(<span class="hljs-string">&quot;drv&quot;</span>, <span class="hljs-keyword">this</span>);<br>   <span class="hljs-keyword">end</span><br>   mon = my_monitor::type_id::create(<span class="hljs-string">&quot;mon&quot;</span>, <span class="hljs-keyword">this</span>);<br><span class="hljs-keyword">endfunction</span> <br><br><span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> my_agent::connect_phase(uvm_phase phase);<br>   <span class="hljs-keyword">super</span><span class="hljs-variable">.connect_phase</span>(phase);<br>   <span class="hljs-keyword">if</span> (is_active == UVM_ACTIVE) <span class="hljs-keyword">begin</span><br>      drv<span class="hljs-variable">.seq_item_port</span><span class="hljs-variable">.connect</span>(sqr<span class="hljs-variable">.seq_item_export</span>);<br>   <span class="hljs-keyword">end</span><br>   ap = mon<span class="hljs-variable">.ap</span>;<br><span class="hljs-keyword">endfunction</span><br><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br><br></code></pre></td></tr></table></figure>



<h4 id="my-sequencer-sv"><a href="#my-sequencer-sv" class="headerlink" title="my_sequencer.sv"></a>my_sequencer.sv</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> MY_SEQUENCER__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> MY_SEQUENCER__SV</span><br><br><span class="hljs-keyword">class</span> my_sequencer <span class="hljs-keyword">extends</span> uvm_sequencer <span class="hljs-variable">#(my_transaction)</span>;<br>   <br>   <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name, uvm_component parent);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);<br>   <span class="hljs-keyword">endfunction</span> <br>   <br>   `uvm_component_utils(my_sequencer)<br><span class="hljs-keyword">endclass</span><br><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>



<h4 id="my-monitor-sv"><a href="#my-monitor-sv" class="headerlink" title="my_monitor.sv"></a>my_monitor.sv</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> MY_MONITOR__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> MY_MONITOR__SV</span><br><span class="hljs-keyword">class</span> my_monitor <span class="hljs-keyword">extends</span> uvm_monitor;<br><br>   <span class="hljs-keyword">virtual</span> my_if vif;<br><br>   uvm_analysis_port <span class="hljs-variable">#(my_transaction)</span>  ap;<br>   <br>   `uvm_component_utils(my_monitor)<br>   <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name = <span class="hljs-string">&quot;my_monitor&quot;</span>, uvm_component parent = <span class="hljs-literal">null</span>);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);<br>   <span class="hljs-keyword">endfunction</span><br><br>   <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br>      <span class="hljs-keyword">if</span>(!uvm_config_db<span class="hljs-variable">#(virtual my_if)::get(this, &quot;&quot;, &quot;vif&quot;, vif))</span><br>         `uvm_fatal(<span class="hljs-string">&quot;my_monitor&quot;</span>, <span class="hljs-string">&quot;virtual interface must be set for vif!!!&quot;</span>)<br>      ap = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;ap&quot;</span>, <span class="hljs-keyword">this</span>);<br>   <span class="hljs-keyword">endfunction</span><br><br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">task</span> main_phase(uvm_phase phase);<br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">task</span> collect_one_pkt(my_transaction tr);<br><span class="hljs-keyword">endclass</span><br><br><span class="hljs-keyword">task</span> my_monitor::main_phase(uvm_phase phase);<br>   my_transaction tr;<br>   <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">begin</span><br>      tr = <span class="hljs-keyword">new</span>(<span class="hljs-string">&quot;tr&quot;</span>);<br>      collect_one_pkt(tr);<br>      ap<span class="hljs-variable">.write</span>(tr);<br>   <span class="hljs-keyword">end</span><br><span class="hljs-keyword">endtask</span><br><br><span class="hljs-keyword">task</span> my_monitor::collect_one_pkt(my_transaction tr);<br>   <span class="hljs-keyword">byte</span> <span class="hljs-keyword">unsigned</span> data_q[$];<br>   <span class="hljs-keyword">byte</span> <span class="hljs-keyword">unsigned</span> data_array[];<br>   <span class="hljs-keyword">logic</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] data;<br>   <span class="hljs-keyword">logic</span> valid = <span class="hljs-number">0</span>;<br>   <span class="hljs-keyword">int</span> data_size;<br>   <br>   <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">begin</span><br>      @(<span class="hljs-keyword">posedge</span> vif<span class="hljs-variable">.clk</span>);<br>      <span class="hljs-keyword">if</span>(vif<span class="hljs-variable">.valid</span>) <span class="hljs-keyword">break</span>;<br>   <span class="hljs-keyword">end</span><br>   <br>   `uvm_info(<span class="hljs-string">&quot;my_monitor&quot;</span>, <span class="hljs-string">&quot;begin to collect one pkt&quot;</span>, UVM_LOW);<br>   <span class="hljs-keyword">while</span>(vif<span class="hljs-variable">.valid</span>) <span class="hljs-keyword">begin</span><br>      data_q<span class="hljs-variable">.push_back</span>(vif<span class="hljs-variable">.data</span>);<br>      @(<span class="hljs-keyword">posedge</span> vif<span class="hljs-variable">.clk</span>);<br>   <span class="hljs-keyword">end</span><br>   data_size  = data_q<span class="hljs-variable">.size</span>();   <br>   data_array = <span class="hljs-keyword">new</span>[data_size];<br>   <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; data_size; i++ ) <span class="hljs-keyword">begin</span><br>      data_array[i] = data_q[i]; <br>   <span class="hljs-keyword">end</span><br>   tr<span class="hljs-variable">.pload</span> = <span class="hljs-keyword">new</span>[data_size - <span class="hljs-number">18</span>]; <span class="hljs-comment">//da sa, e_type, crc</span><br>   data_size = tr<span class="hljs-variable">.unpack_bytes</span>(data_array) / <span class="hljs-number">8</span>; <br>   `uvm_info(<span class="hljs-string">&quot;my_monitor&quot;</span>, <span class="hljs-string">&quot;end collect one pkt&quot;</span>, UVM_LOW);<br><span class="hljs-keyword">endtask</span><br><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br><br></code></pre></td></tr></table></figure>



<h4 id="my-driver-sv"><a href="#my-driver-sv" class="headerlink" title="my_driver.sv"></a>my_driver.sv</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> MY_DRIVER__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> MY_DRIVER__SV</span><br><span class="hljs-keyword">class</span> my_driver <span class="hljs-keyword">extends</span> uvm_driver<span class="hljs-variable">#(my_transaction)</span>;<br><br>   <span class="hljs-keyword">virtual</span> my_if vif;<br><br>   `uvm_component_utils(my_driver)<br>   <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name = <span class="hljs-string">&quot;my_driver&quot;</span>, uvm_component parent = <span class="hljs-literal">null</span>);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>(name, parent);<br>   <span class="hljs-keyword">endfunction</span><br><br>   <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> build_phase(uvm_phase phase);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.build_phase</span>(phase);<br>      <span class="hljs-keyword">if</span>(!uvm_config_db<span class="hljs-variable">#(virtual my_if)::get(this, &quot;&quot;, &quot;vif&quot;, vif))</span><br>         `uvm_fatal(<span class="hljs-string">&quot;my_driver&quot;</span>, <span class="hljs-string">&quot;virtual interface must be set for vif!!!&quot;</span>)<br>   <span class="hljs-keyword">endfunction</span><br><br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">task</span> main_phase(uvm_phase phase);<br>   <span class="hljs-keyword">extern</span> <span class="hljs-keyword">task</span> drive_one_pkt(my_transaction tr);<br><span class="hljs-keyword">endclass</span><br><br><span class="hljs-keyword">task</span> my_driver::main_phase(uvm_phase phase);<br>   vif<span class="hljs-variable">.data</span> &lt;= <span class="hljs-number">8&#x27;b0</span>;<br>   vif<span class="hljs-variable">.valid</span> &lt;= <span class="hljs-number">1&#x27;b0</span>;<br>   <span class="hljs-keyword">while</span>(!vif<span class="hljs-variable">.rst_n</span>)<br>      @(<span class="hljs-keyword">posedge</span> vif<span class="hljs-variable">.clk</span>);<br>   <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">begin</span><br>      seq_item_port<span class="hljs-variable">.get_next_item</span>(req);<br>      drive_one_pkt(req);<br>      seq_item_port<span class="hljs-variable">.item_done</span>();<br>   <span class="hljs-keyword">end</span><br><span class="hljs-keyword">endtask</span><br><br><span class="hljs-keyword">task</span> my_driver::drive_one_pkt(my_transaction tr);<br>   <span class="hljs-keyword">byte</span> <span class="hljs-keyword">unsigned</span>     data_q[];<br>   <span class="hljs-keyword">int</span>  data_size;<br>   <br>   data_size = tr<span class="hljs-variable">.pack_bytes</span>(data_q) / <span class="hljs-number">8</span>; <br>   `uvm_info(<span class="hljs-string">&quot;my_driver&quot;</span>, <span class="hljs-string">&quot;begin to drive one pkt&quot;</span>, UVM_LOW);<br>   <span class="hljs-keyword">repeat</span>(<span class="hljs-number">3</span>) @(<span class="hljs-keyword">posedge</span> vif<span class="hljs-variable">.clk</span>);<br>   <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; data_size; i++ ) <span class="hljs-keyword">begin</span><br>      @(<span class="hljs-keyword">posedge</span> vif<span class="hljs-variable">.clk</span>);<br>      vif<span class="hljs-variable">.valid</span> &lt;= <span class="hljs-number">1&#x27;b1</span>;<br>      vif<span class="hljs-variable">.data</span> &lt;= data_q[i]; <br>   <span class="hljs-keyword">end</span><br><br>   @(<span class="hljs-keyword">posedge</span> vif<span class="hljs-variable">.clk</span>);<br>   vif<span class="hljs-variable">.valid</span> &lt;= <span class="hljs-number">1&#x27;b0</span>;<br>   `uvm_info(<span class="hljs-string">&quot;my_driver&quot;</span>, <span class="hljs-string">&quot;end drive one pkt&quot;</span>, UVM_LOW);<br><span class="hljs-keyword">endtask</span><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br><br></code></pre></td></tr></table></figure>

<h4 id="my-transaction-sv"><a href="#my-transaction-sv" class="headerlink" title="my_transaction.sv"></a>my_transaction.sv</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> MY_TRANSACTION__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> MY_TRANSACTION__SV</span><br><br><span class="hljs-keyword">class</span> my_transaction <span class="hljs-keyword">extends</span> uvm_sequence_item;<br><br>   <span class="hljs-keyword">rand</span> <span class="hljs-keyword">bit</span>[<span class="hljs-number">47</span>:<span class="hljs-number">0</span>] dmac;<br>   <span class="hljs-keyword">rand</span> <span class="hljs-keyword">bit</span>[<span class="hljs-number">47</span>:<span class="hljs-number">0</span>] smac;<br>   <span class="hljs-keyword">rand</span> <span class="hljs-keyword">bit</span>[<span class="hljs-number">15</span>:<span class="hljs-number">0</span>] ether_type;<br>   <span class="hljs-keyword">rand</span> <span class="hljs-keyword">byte</span>      pload[];<br>   <span class="hljs-keyword">rand</span> <span class="hljs-keyword">bit</span>[<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] crc;<br><br>   <span class="hljs-keyword">constraint</span> pload_cons&#123;<br>      pload<span class="hljs-variable">.size</span> &gt;= <span class="hljs-number">46</span>;<br>      pload<span class="hljs-variable">.size</span> &lt;= <span class="hljs-number">1500</span>;<br>   &#125;<br><br>   <span class="hljs-keyword">function</span> <span class="hljs-keyword">bit</span>[<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] calc_crc();<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">32&#x27;h0</span>;<br>   <span class="hljs-keyword">endfunction</span><br><br>   <span class="hljs-keyword">function</span> <span class="hljs-keyword">void</span> post_randomize();<br>      crc = calc_crc;<br>   <span class="hljs-keyword">endfunction</span><br>   <span class="hljs-comment">//UVM中field_automation机制，使用uvm_field系列宏实现</span><br>   <span class="hljs-comment">//使用uvm_object_utils_begin和uvm_object_utils_end来实现my_transaction的factory注册，在这两个宏中间，</span><br>   <span class="hljs-comment">//使用uvm_field宏注册所有字段。uvm_field系列宏随着transaction成员变量的不同而不同，</span><br>   <span class="hljs-comment">//如上面的定义中出现了针对bit类型的  uvm_field_int及针对byte类型动态数组的uvm_field_array_int</span><br>   <span class="hljs-comment">//当使用上述宏注册之后，可以直接调用copy、compare、print等函数，而无需自己定义</span><br>   `uvm_object_utils_begin(my_transaction)<br>      `uvm_field_int(dmac, UVM_ALL_ON)<br>      `uvm_field_int(smac, UVM_ALL_ON)<br>      `uvm_field_int(ether_type, UVM_ALL_ON)<br>      `uvm_field_array_int(pload, UVM_ALL_ON)<br>      `uvm_field_int(crc, UVM_ALL_ON)<br>   `uvm_object_utils_end<br><br>   <span class="hljs-keyword">function</span> <span class="hljs-keyword">new</span>(<span class="hljs-keyword">string</span> name = <span class="hljs-string">&quot;my_transaction&quot;</span>);<br>      <span class="hljs-keyword">super</span><span class="hljs-variable">.new</span>();<br>   <span class="hljs-keyword">endfunction</span><br><br><span class="hljs-keyword">endclass</span><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br><br></code></pre></td></tr></table></figure>

<h4 id="my-vif-sv"><a href="#my-vif-sv" class="headerlink" title="my_vif.sv"></a>my_vif.sv</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">ifndef</span> MY_IF__SV</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> MY_IF__SV</span><br><br><span class="hljs-keyword">interface</span> my_if(<span class="hljs-keyword">input</span> clk, <span class="hljs-keyword">input</span> rst_n);<br><br>   <span class="hljs-keyword">logic</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] data;<br>   <span class="hljs-keyword">logic</span> valid;<br><span class="hljs-keyword">endinterface</span><br><br><span class="hljs-meta">`<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>

<h4 id="dut-sv"><a href="#dut-sv" class="headerlink" title="dut.sv"></a>dut.sv</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">module</span> dut(clk,<br>           rst_n, <br>           rxd,<br>           rx_dv,<br>           txd,<br>           tx_en);<br><span class="hljs-keyword">input</span> clk;<br><span class="hljs-keyword">input</span> rst_n;<br><span class="hljs-keyword">input</span>[<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] rxd;<br><span class="hljs-keyword">input</span> rx_dv;<br><span class="hljs-keyword">output</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] txd;<br><span class="hljs-keyword">output</span> tx_en;<br><br><span class="hljs-keyword">reg</span>[<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] txd;<br><span class="hljs-keyword">reg</span> tx_en;<br><br><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk) <span class="hljs-keyword">begin</span><br>   <span class="hljs-keyword">if</span>(!rst_n) <span class="hljs-keyword">begin</span><br>      txd &lt;= <span class="hljs-number">8&#x27;b0</span>;<br>      tx_en &lt;= <span class="hljs-number">1&#x27;b0</span>;<br>   <span class="hljs-keyword">end</span><br>   <span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span><br>      txd &lt;= rxd;<br>      tx_en &lt;= rx_dv;<br>   <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br><span class="hljs-keyword">endmodule</span><br><br></code></pre></td></tr></table></figure>



<h2 id="图片解释"><a href="#图片解释" class="headerlink" title="图片解释"></a>图片解释</h2><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/UVM/" class="category-chain-item">UVM</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/UVM/">#UVM</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>UVM基础知识笔记</div>
      <div>http://vinters-v.github.io/2025/03/22/数字IC——UVM/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Vinters-v</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年3月22日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/03/29/%E6%95%B0%E5%AD%97IC_SystemVerilog/" title="SystemVerilog语法">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">SystemVerilog语法</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/11/13/%E6%95%B0%E5%AD%97IC_VSC%E4%BB%BF%E7%9C%9F%E7%9B%B8%E5%85%B3/" title="VCS仿真相关">
                        <span class="hidden-mobile">VCS仿真相关</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
